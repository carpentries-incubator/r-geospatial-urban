<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Geospatial Data Carpentry for Urbanism: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Geospatial Data Carpentry for Urbanism
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Geospatial Data Carpentry for Urbanism
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Geospatial Data Carpentry for Urbanism
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro-to-r.html">1. Introduction to R and RStudio</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-data-structures.html">2. Data Structures</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-explore-data.html">3. Exploring Data Frames &amp; Data frame Manipulation with dplyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-intro-to-visualisation.html">4. Introduction to visualisation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="08-intro-to-geospatial-concepts.html">5. Introduction to Geospatial Concepts</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="09-open-and-plot-vector-layers.html">6. Open and Plot Vector Layers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="10-explore-and-plot-by-vector-layer-attributes.html">7. Explore and plot by vector layer attributes</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="11-plot-multiple-shape-files.html">8. Plot multiple shapefiles</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="12-handling-spatial-projection-and-crs.html">9. Handling Spatial Projections &amp; CRS</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="13-intro-to-raster-data.html">10. Intro to Raster Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="14-plot-raster-data.html">11. Plot Raster Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="15-reproject-raster-data.html">12. Reproject Raster Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="16-raster-calculations.html">13. Raster Calculations</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="17-work-with-multi-band-rasters.html">14. Work with Multi-Band Rasters</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="18-import-and-visualise-osm-data.html">15. Import and Visualise OSM Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="19-basic-gis-with-r-sf.html">16. Basic GIS operations with R and sf</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-intro-to-r"><p>Content from <a href="01-intro-to-r.html">Introduction to R and RStudio</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/01-intro-to-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 50 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I find my way around RStudio?</li>
<li>How can I manage projects in R?</li>
<li>How can I install packages?</li>
<li>How can I interact with R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Create self-contained projects in RStudio</li>
<li>Install additional packages using R code.</li>
<li>Manage packages</li>
<li>Define a variable</li>
<li>Assign data to a variable</li>
<li>Call functions</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="project-management-in-rstudio">Project management in RStudio<a class="anchor" aria-label="anchor" href="#project-management-in-rstudio"></a>
</h1>
<p>RStudio is an integrated development environment (IDE), which means
it provides a (much prettier) interface for the R software. For RStudio
to work, you need to have R installed on your computer. But R is
integrated into RStudio, so you never actually have to open R
software.</p>
<p>RStudio provides a useful feature: creating projects - self-contained
working space (i.e. working directory), to which R will refer to, when
looking for and saving files. You can create projects in existing
directories (folders) or create a new one.</p>
<div class="section level2">
<h2 id="creating-rstudio-project">Creating RStudio Project<a class="anchor" aria-label="anchor" href="#creating-rstudio-project"></a>
</h2>
<p>We’re going to create a project in RStudio in a new directory. To
create a project, go to:</p>
<ul>
<li><code>File</code></li>
<li><code>New Project</code></li>
<li><code>New directory</code></li>
<li>Place the project that you will easily find on your laptop and name
the project <code>data-carpentry</code>
</li>
<li><code>Create project</code></li>
</ul>
</div>
<div class="section level2">
<h2 id="organising-working-directory">Organising working directory<a class="anchor" aria-label="anchor" href="#organising-working-directory"></a>
</h2>
<p>Creating an RStudio project is a good first step towards good project
management. However, most of the time it is a good idea to organize
working space further. This is one suggestion of how your R project can
look like. Let’s go ahead and create the other folders:</p>
<ul>
<li>
<code>data/</code> - should be where your raw data is. <strong>READ
ONLY</strong>
</li>
<li>
<code>data_output/</code> - should be where your data output is
saved <strong>READ AND WRITE</strong>
</li>
<li>
<code>documents/</code> - all the documentation associated with the
project (e.g. cookbook)</li>
<li>
<code>fig_output/</code> - your figure outputs go here <strong>WRITE
ONLY</strong>
</li>
<li>
<code>scripts/</code> - all your code goes here <strong>READ AND
WRITE</strong>
</li>
</ul>
<figure><img src="../fig/rstudio_project_files.jpeg" alt="RStudio project logo with five lines, each leading from the logo towards one of the five boxes with texts: 'data/', 'data_output/', 'documents/', 'fig_output/', 'scripts/'" class="figure mx-auto d-block"><div class="figcaption">R project organization</div>
</figure><p>You can create these folders as you would any other folders on your
laptop, but R and RStudio offer handy ways to do it directly in your
RStudio session.</p>
<p>You can use RStudio interface to create a folder in your project by
going to lower-bottom pane, files tab, and clicking on Folder icon. A
dialog box will appear, allowing you typing a name of a folder you want
to create.</p>
<p>An alternative solution is to create the folders using R command
<code>dir.create()</code>. In the console type:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data_output"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"documents"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"fig_output"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"scripts"</span><span class="op">)</span></span></code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>In interest of time, focus on one way of creating the folders. You
can showcase an alternative method with just one example.</p>
<p>Once you have finished, ask the participants if they have managed to
create a R Project and get the same folder structure. To do this, use
green and red stickers.</p>
<p>This will become important, as we use relative paths together with
<code>here</code> package to read and write objects.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="two-main-ways-to-interact-with-r">Two main ways to interact with R<a class="anchor" aria-label="anchor" href="#two-main-ways-to-interact-with-r"></a>
</h2>
<p>There are two main ways to interact with R through RStudio:</p>
<ul>
<li>test and play environment within the interactive <strong>R
console</strong>
</li>
<li>write and save an <strong>R script (<code>.R</code>
file)</strong>
</li>
</ul>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>When you open the RStudio or create the Rstudio project, you will see
Console window on the left by default. Once you create an R script, it
is placed in the upper left pane. The Console is moved to the bottom
left pane.</p>
</div>
</div>
</div>
<p>Each of the modes o interactions has its advantages and
drawbacks.</p>
<table class="table">
<colgroup>
<col width="30%">
<col width="34%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Console</th>
<th>R script</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Pros</strong></td>
<td>Immediate results</td>
<td>Complete record of your work</td>
</tr>
<tr class="even">
<td><strong>Cons</strong></td>
<td>Work lost once you close RStudio</td>
<td>Messy if you just want to print things out</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="creating-a-script">Creating a script<a class="anchor" aria-label="anchor" href="#creating-a-script"></a>
</h2>
<p>During the workshop we will mostly use an <code>.R</code> script to
have a full documentation of what has been written. This way we will
also be able to reproduce the results. Let’s create one now and save it
in the <code>scripts</code> directory.</p>
<ul>
<li><code>File</code></li>
<li><code>New File</code></li>
<li><code>R Script</code></li>
<li>A new <code>Untitled</code> script will appear in the source
pane.</li>
<li>Save it using floppy disc icon.</li>
<li>Select the <code>scripts/</code> folder as the file location</li>
<li>Name the script <code>intro-to-r.R</code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-the-code">Running the code<a class="anchor" aria-label="anchor" href="#running-the-code"></a>
</h2>
<p>Note that all code written in the script can be also executed at a
spot in the<br>
interactive console. We will now learn how to run the code both in the
console and the script.</p>
<ul>
<li>In the Console you run the code by hitting <kbd>Enter</kbd> at the
end of the line</li>
<li>In the R script there are two way to execute the code:
<ul>
<li>You can use the <code>Run</code> button on the top right of the
script window.</li>
<li>Alternatively, you can use a keyboard shortcut: <kbd>Ctrl</kbd> +
<kbd>Enter</kbd> or <kbd>Command</kbd> + <kbd>Return</kbd> for MAC
users.</li>
</ul>
</li>
</ul>
<p>In both cases, the active line (the line where your cursor is placed)
or a highlighted snippet of code will be executed. A common source of
error in scripts, such as a previously created object not found, is code
that has not been executed in previous lines: make sure that all code
has been executed as described above. To run all lines before the active
line, you can use the keyboard shortcut <kbd>Ctrl</kbd> + <kbd>Alt</kbd>
+ <kbd>B</kbd> on Windows/Linux or <kbd>Command</kbd> +
<kbd>option</kbd> + <kbd>B</kbd> on Mac.</p>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>A great power of R lays in <strong>packages: add-on sets of
functions</strong> that are build by the community and once they go
through a quality process they are available to download from a
repository called <code>CRAN</code>. They need to be explicitly
activated. Now, we will be using <code>tidyverse</code> package, which
is actually a collection of useful packages. Another package that we
will use is <code>here</code>.</p>
<p>You were asked to install <code>tidyverse</code> package in the
preparation for the workshop. You need to install a package only once,
so you won’t have to do it again. We will however need to install the
<code>here</code> package. To do so, please go to your script and
type:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"here"</span><span class="op">)</span></span></code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>If you are not sure if you have <code>tidyverse</code> packaged
installed, you can check it in the <code>Packages</code> tab in the
bottom right pane. In the search box start typing
‘<code>tidyverse</code>’ and see if it appears in the list of installed
packages. If not, you will need to install it by writing in the
script:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'tidyverse'</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="commenting-your-code" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="commenting-your-code" class="callout-inner">
<h3 class="callout-title">Commenting your code</h3>
<div class="callout-content">
<p>Now we have a bit of an issue with our script. As mentioned, the
packages need to be installed only once, but now, they will be installed
each time we run the script, which can take a lot of time if we’re
installing a large package like <code>tidyverse</code>.</p>
<p>To keep a trace of you installing the packages, without executing it,
you can use a comment. In <code>R</code>, anything that is written after
a has sign <code>#</code>, is ignored in execution. Thanks to this
feature, you can annotate your code. Let’s adapt our script by changing
the first lines into comments:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages('here')</span></span>
<span><span class="co"># install.packages('tidyverse')</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Installing packages is not sufficient to work with them. You will
need to load them each time you want to use them. To do that you use
<code>library()</code> command:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="handling-paths">Handling paths<a class="anchor" aria-label="anchor" href="#handling-paths"></a>
</h2>
<p>You have created a project which is your working directory, and a few
sub-folders, that will help you organise your project better. But now,
each time you will save or retrieve a file from those folders, you will
need to specify the path from the folder you are in (most likely the
<code>scripts/</code> folder) to those files.</p>
<p>That can become complicated and might cause a reproducibility
problem, if the person using your code (including future you) is working
in a different sub-folder.</p>
<p>We will use the <code>here()</code> package to tackle this issue.
This package converts relative paths from the root (main folder) of your
project to absolute paths (the exact location on your computer). For
instance, instead of writing out the full path like
“C:/Users/YourName/Documents/r-geospatial-urban/data/file.csv” or
“~/Documents/r-geospatial-urban/data/file.csv”, you can use the
<code>here()</code> function to create a path relative to your project’s
main directory. This makes your code more portable and reproducible, as
it doesn’t depend on a specific location of your project on your
computer.</p>
<p>It might be confusing, so let’s see how it works. We will use the
<code>here()</code> function from the <code>here</code> package. In the
console, we write:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">here</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">here</span><span class="op">(</span><span class="st">'data'</span><span class="op">)</span></span></code></pre>
</div>
<p>You all probably have something different printed out. And this is
fine, because <code>here</code> adapts to your computer’s specific
situation.</p>
</div>
<div class="section level2">
<h2 id="download-files">Download files<a class="anchor" aria-label="anchor" href="#download-files"></a>
</h2>
<p>We still need to download data for the first part of the workshop.
You can do it with the function <code>download.file()</code>. We will
save it in the <code>data/</code> folder, where the <strong>raw</strong>
data should go. In the script, we will write:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download the data</span></span>
<span><span class="fu">download.file</span><span class="op">(</span></span>
<span>  <span class="st">"https://bit.ly/geospatial_data"</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>The data we just downloaded is data about country statistics,
containing information on, for instance, GDP and life-expectancy. We
will work with this data later in the lesson</p>
<div id="importing-data-into-r" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="importing-data-into-r" class="callout-inner">
<h3 class="callout-title">Importing data into R</h3>
<div class="callout-content">
<p>Three of the most common ways of importing data in R are:</p>
<ul>
<li>loading a package with pre-installed data;</li>
<li>downloading data from a URL;</li>
<li>reading a file from your computer.</li>
</ul>
<p>For larger datasets, database connections or API requests are also
possible. We will not cover these in the workshop.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="introduction-to-r">Introduction to R<a class="anchor" aria-label="anchor" href="#introduction-to-r"></a>
</h1>
<p>You can use R as calculator, you can for example write:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">+</span> <span class="fl">100</span></span>
<span><span class="fl">1</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="fl">1</span> <span class="op">/</span> <span class="fl">100</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="variables-and-assignment">Variables and assignment<a class="anchor" aria-label="anchor" href="#variables-and-assignment"></a>
</h2>
<p>However, what’s more useful is that in R we can store values and use
them whenever we need to. We using the assignment operator
<code>&lt;-</code>, like this:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">40</span></span></code></pre>
</div>
<p>Notice that assignment does not print a value. Instead, we’ve stored
it for later in something called a variable. <code>x</code> variable now
contains the value <code>0.025</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<p>Look for the <code>Environment</code> tab in the upper right pane of
RStudio. You will see that <code>x</code> and its value have appeared in
the list of Values. Our variable <code>x</code> can be used in place of
a number in any calculation that expects a number, e.g. when calculating
a square root:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<p>Variables can be also reassigned. This means that we can assign a new
value to variable <code>x</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<p>You can use one variable to create a new one:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># you can use value stored in object x to create y</span></span>
<span><span class="va">y</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to write and run R programs.</li>
<li>Use <code>install.packages()</code> to install packages.</li>
<li>Use <code>library()</code> to load packages.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section><section id="aio-02-data-structures"><p>Content from <a href="02-data-structures.html">Data Structures</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/02-data-structures.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the basic data types in R?</li>
<li>How do I represent categorical information in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>To be aware of the different types of data.</li>
<li>To begin exploring data frames, and understand how they are related
to vectors, factors and lists.</li>
<li>To be able to ask questions from R about the type, class, and
structure of an object.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="vectors">Vectors<a class="anchor" aria-label="anchor" href="#vectors"></a>
</h2>
<hr class="half-width">
<p>So far we’ve looked at individual values, such as x &lt;- 100. Now we
will move to a data structure called vectors. Vectors are arrays of
values of the same data type. So now we combine multiple values into one
object: x &lt;- c(100, 200)</p>
<div id="data-types" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-types" class="callout-inner">
<h3 class="callout-title">Data types</h3>
<div class="callout-content">
<p>Data type refers to a type of information that is stored by a value.
It can be:</p>
<ul>
<li>
<code>numerical</code> (a number)</li>
<li>
<code>integer</code> (a number without information about decimal
points)</li>
<li>
<code>logical</code> (a boolean - are values TRUE or FALSE?)</li>
<li>
<code>character</code> (a text/ string of characters)</li>
<li>
<code>complex</code> (a complex number)</li>
<li>
<code>raw</code> (raw bytes)</li>
</ul>
<p>We won’t discuss <code>complex</code> or <code>raw</code> data type
in the workshop.</p>
</div>
</div>
</div>
<div id="data-structures" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-structures" class="callout-inner">
<h3 class="callout-title">Data structures</h3>
<div class="callout-content">
<p>Vectors are the most common and basic data structure in R but you
will come across other data structures such as data frames, lists and
matrices as well. In short:</p>
<ul>
<li>data.frames is a two-dimensional data structure in which columns are
vectors of the same length that can have different data types. We will
use this data structure in this lesson.</li>
<li>lists can have an arbitrary structure and can mix data types;</li>
<li>matrices are two-dimensional data structures containing elements of
the same data type.</li>
</ul>
<p>For a more detailed description, see <a href="https://swcarpentry.github.io/r-novice-inflammation/13-supp-data-structures.html" class="external-link">Data
Types and Structures</a>.</p>
<p>Note that vector data in the geospatial context is different from
vector data types. More about vector data in a <a href="09-open-and-plot-vector-layers.html">later lesson</a>!</p>
</div>
</div>
</div>
<p>You can create a vector with a <code>c()</code> function.</p>
<p>You can inspect vectors with the <code>str()</code> function. In
factor vectors, it shows the underlying values of each category. You can
also see the structure in the environment tab of RStudio.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vector of numbers - numeric data type.</span></span>
<span><span class="va">numeric_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span> </span>
<span><span class="va">numeric_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 6 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">numeric_vector</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3] 2 6 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vector of words - or strings of characters- character data type. Note that we need to use quotation marks '' to tell R that we are working with strings. If there is a ' mark in the string itself, such as s'Gravenhage, then we use "".</span></span>
<span><span class="va">character_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'Amsterdam'</span>, <span class="st">"'s Gravenhage"</span>, <span class="st">'Delft'</span><span class="op">)</span> </span>
<span><span class="va">character_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Amsterdam"     "'s Gravenhage" "Delft"        </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">character_vector</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "Amsterdam" "'s Gravenhage" "Delft"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vector of logical values (is something true or false?)- logical data type.</span></span>
<span><span class="va">logical_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">logical_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE FALSE  TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">logical_vector</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> logi [1:3] TRUE FALSE TRUE</code></pre>
</div>
<div class="section level3">
<h3 id="combining-vectors">Combining vectors<a class="anchor" aria-label="anchor" href="#combining-vectors"></a>
</h3>
<p>The combine function, <code>c()</code>, will also append things to an
existing vector:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ab_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span></span>
<span><span class="va">ab_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abcd_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">ab_vector</span>, <span class="st">'c'</span>, <span class="st">'d'</span><span class="op">)</span></span>
<span><span class="va">abcd_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b" "c" "d"</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="missing-values">Missing values<a class="anchor" aria-label="anchor" href="#missing-values"></a>
</h3>
<div id="challenge-combining-vectors" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-combining-vectors" class="callout-inner">
<h3 class="callout-title">Challenge: combining vectors</h3>
<div class="callout-content">
<p>Combine the <code>abcd_vector</code> with the
<code>numeric_vector</code> in R. What is the data type of this new
vector and why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<pre><code><span><span class="va">combined_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">abcd_vector</span>, <span class="va">numeric_vector</span><span class="op">)</span></span>
<span><span class="va">combined_vector</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">combined_vector</span><span class="op">)</span></span></code></pre>
<p>The combined vector is a character vector. Because vectors can only
hold one data type and <code>abcd_vector</code> cannot be interpreted as
numbers, the numbers in <code>numeric_vector</code> are <em>coerced</em>
into characters.</p>
</div>
</div>
</div>
</div>
<p>A common operation you want to perform is to remove all the missing
values (in R denoted as <code>NA</code>). Let’s have a look how to do
it:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">with_na</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="cn">NA</span> <span class="op">)</span> <span class="co"># vector including missing value</span></span></code></pre>
</div>
<p>First, let’s try to calculate mean for the values in this vector</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="co"># mean() function cannot interpret the missing values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You can add the argument na.rm=TRUE to calculate the result while</span></span>
<span><span class="co"># ignoring the missing values.</span></span>
<span><span class="fu">mean</span><span class="op">(</span><span class="va">with_na</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.6</code></pre>
</div>
<p>However, sometimes, you would like to have the <code>NA</code>
permanently removed from your vector. For this you need to identify
which elements of the vector hold missing values with
<code>is.na()</code> function.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="co"># This will produce a vector of logical values, </span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stating if a statement 'This element of the vector is a missing value'</span></span>
<span><span class="co"># is true or not</span></span>
<span></span>
<span><span class="co"># to see how many values are missing in our with_na vector, we can use the sum function</span></span>
<span><span class="fu">sum</span><span class="op">(</span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to identify the values that are not missing we write the following</span></span>
<span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="co"># The ! operator means negation, i.e. not is.na(with_na)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#and to sum all the non-missing values we write</span></span>
<span><span class="fu">sum</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5</code></pre>
</div>
<p>We know which elements in the vectors are <code>NA</code>. Now we
need to retrieve the subset of the <code>with_na</code> vector that is
not <code>NA</code>. Sub-setting in <code>R</code> is done with square
brackets<code>[ ]</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">without_na</span> <span class="op">&lt;-</span> <span class="va">with_na</span><span class="op">[</span> <span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">with_na</span><span class="op">)</span> <span class="op">]</span> <span class="co"># this notation will return only</span></span>
<span><span class="co"># the elements that have TRUE on their respective positions</span></span>
<span></span>
<span><span class="va">without_na</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 1 1 3</code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="factors">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h2>
<hr class="half-width">
<p>Another important data structure is called a <strong>factor</strong>.
Factors look like character data, but are used to represent categorical
information.</p>
<p>Factors create a structured relation between the different levels
(values) of a categorical variable, such as days of the week or
responses to a question in a survey. While factors look (and often
behave) like character vectors, they are actually treated as numbers by
<code>R</code>, which is useful for computing summary statistics about
their distribution, running regression analysis, etc. So you need to be
very careful when treating them as strings.</p>
<div class="section level3">
<h3 id="create-factors">Create factors<a class="anchor" aria-label="anchor" href="#create-factors"></a>
</h3>
<p>Once created, factors can only contain a pre-defined set of values,
known as levels.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_str</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'Norway'</span>, <span class="st">'Sweden'</span>, <span class="st">'Norway'</span>, <span class="st">'Denmark'</span>, <span class="st">'Sweden'</span><span class="op">)</span></span>
<span><span class="va">nordic_str</span> <span class="co"># regular character vectors printed out</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Norway"  "Sweden"  "Norway"  "Denmark" "Sweden" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># factor() function converts a vector to factor data type</span></span>
<span><span class="va">nordic_cat</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic_str</span><span class="op">)</span></span>
<span><span class="va">nordic_cat</span> <span class="co"># With factors, R prints out additional information - 'Levels'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden
Levels: Denmark Norway Sweden</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_cat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden
Levels: Denmark Norway Sweden</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic_cat</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> Factor w/ 3 levels "Denmark","Norway",..: 2 3 2 1 3</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="inspect-factors">Inspect factors<a class="anchor" aria-label="anchor" href="#inspect-factors"></a>
</h3>
<p>R will treat each unique value from a factor vector as a
<strong>level</strong> and (silently) assign numerical values to it.
This can come in handy when performing statistical analysis. You can
inspect and adapt levels of the factor.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">nordic_cat</span><span class="op">)</span> <span class="co"># returns all levels of a factor vector.  </span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Norway"  "Sweden" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlevels</span><span class="op">(</span><span class="va">nordic_cat</span><span class="op">)</span> <span class="co"># returns number of levels in a vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="reorder-levels">Reorder levels<a class="anchor" aria-label="anchor" href="#reorder-levels"></a>
</h3>
<p>Note that <code>R</code> sorts the levels in the alphabetic order,
not in the order of occurrence in the vector. <code>R</code> assigns
value of:</p>
<ul>
<li>1 to level ‘Denmark’,</li>
<li>2 to ‘Norway’</li>
<li>3 to ‘Sweden’.</li>
</ul>
<p>This is important as it can affect e.g. the order in which categories
are displayed in a plot or which category is taken as a baseline in a
statistical model.</p>
<p>You can reorder the categories using <code>factor()</code> function.
This can be useful, for instance, to select a reference category (first
level) in a regression model or for ordering legend items in a plot,
rather than using the default category systematically (i.e. based on
alphabetical order).</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_cat</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span></span>
<span>  <span class="va">nordic_cat</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>    <span class="st">"Norway"</span>,</span>
<span>    <span class="st">"Denmark"</span>,</span>
<span>    <span class="st">"Sweden"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now Norway will be the first category, Denmark second and Sweden third</span></span>
<span><span class="va">nordic_cat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden
Levels: Norway Denmark Sweden</code></pre>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>There is more than one way to reorder factors. Later in the lesson,
we will use <code>fct_relevel()</code> function from
<code>forcats</code> package to do the reordering.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nordic_cat</span> <span class="op">&lt;-</span> <span class="fu">fct_relevel</span><span class="op">(</span></span>
<span>  <span class="va">nordic_cat</span>,</span>
<span>  <span class="st">"Norway"</span>,</span>
<span>  <span class="st">"Denmark"</span>,</span>
<span>  <span class="st">"Sweden"</span></span>
<span><span class="op">)</span> <span class="co"># With this, Norway will be  first category,</span></span>
<span><span class="co"># Denmark second and Sweden third</span></span>
<span></span>
<span><span class="va">nordic_cat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  Sweden  Norway  Denmark Sweden
Levels: Norway Denmark Sweden</code></pre>
</div>
<div class="section level3">
<h3 id="note-of-caution">Note of caution<a class="anchor" aria-label="anchor" href="#note-of-caution"></a>
</h3>
<p>Remember that once created, factors can only contain a pre-defined
set of values, known as levels. It means that whenever you try to add
something to the factor outside of this set, it will become an
unknown/missing value detonated by <code>R</code> as
<code>NA</code>.</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_str</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Norway"  "Sweden"  "Norway"  "Denmark" "Sweden" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_cat2</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span></span>
<span>  <span class="va">nordic_str</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Norway"</span>, <span class="st">"Denmark"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># because we did not include Sweden in the list of</span></span>
<span><span class="co"># factor levels, it has become NA.</span></span>
<span><span class="va">nordic_cat2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Norway  &lt;NA&gt;    Norway  Denmark &lt;NA&gt;
Levels: Norway Denmark</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The mostly used basic data types in R are <code>numeric</code>,
<code>integer</code>, <code>logical</code>, and
<code>character</code>
</li>
<li>Use factors to represent categories in R.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-03-explore-data"><p>Content from <a href="03-explore-data.html">Exploring Data Frames &amp; Data frame Manipulation with dplyr</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/03-explore-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a data frame?</li>
<li>How can I read data in R?</li>
<li>How can I get basic summary information about my data set?</li>
<li>How can I select specific rows and/or columns from a data
frame?</li>
<li>How can I combine multiple commands into a single command?</li>
<li>How can I create new columns or remove existing columns from a data
frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Describe what a data frame is.</li>
<li>Load external data from a .csv file into a data frame.</li>
<li>Summarize the contents of a data frame.</li>
<li>Select certain columns in a data frame with the dplyr function
select.</li>
<li>Select certain rows in a data frame according to filtering
conditions with the dplyr function filter.</li>
<li>Link the output of one dplyr function to the input of another
function with the ‘pipe’ operator %&gt;%.</li>
<li>Add new columns to a data frame that are functions of existing
columns with mutate.</li>
<li>Use the split-apply-combine concept for data analysis.</li>
<li>Use summarize, group_by, and count to split a data frame into groups
of observations, apply a summary statistics for each group, and then
combine the results.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="exploring-data-frames">Exploring Data frames<a class="anchor" aria-label="anchor" href="#exploring-data-frames"></a>
</h1>
<p>Now we turn to the bread-and-butter of working with <code>R</code>:
working with tabular data. In <code>R</code> data are stored in a data
structure called <strong>data frames</strong>.</p>
<p>A data frame is a representation of data in the format of a
<strong>table</strong> where the columns are <strong>vectors</strong>
that all have the <strong>same length</strong>.</p>
<p>Because columns are vectors, each column must contain a
<strong>single type of data</strong> (e.g., characters, numeric,
factors). For example, here is a figure depicting a data frame
comprising a numeric, a character, and a logical vector.</p>
<p><img src="../fig/data-frame.svg" alt="A data frame" class="figure"><br><font size="3"><em>Source</em>: <a href="https://datacarpentry.org/r-socialsci/02-starting-with-data/index.html#what-are-data-frames-and-tibbles" class="external-link">Data
Carpentry R for Social Scientists</a></font></p>
<div class="section level2">
<h2 id="reading-data">Reading data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h2>
<p><code>read.csv()</code> is a function used to read coma separated
data files (<code>.csv</code> format)). There are other functions for
files separated with other delimiters. We’re gonna read in the
<code>gapminder</code> data set with information about countries’ size,
GDP and average life expectancy in different years.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="exploring-dataset">Exploring dataset<a class="anchor" aria-label="anchor" href="#exploring-dataset"></a>
</h2>
<p>Let’s investigate the <code>gapminder</code> data frame a bit; the
first thing we should always do is check out what the data looks
like.</p>
<p>It is important to see if all the variables (columns) have the data
type that we require. For instance, a column might have numbers stored
as characters, which would not allow us to make calculations with those
numbers.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<p>We can see that the <code>gapminder</code> object is a data.frame
with 1704 observations (rows) and 6 variables (columns).</p>
<p>In each line after a <code>$</code> sign, we see the name of each
column, its type and first few values.</p>
<div class="section level3">
<h3 id="first-look-at-the-dataset">First look at the dataset<a class="anchor" aria-label="anchor" href="#first-look-at-the-dataset"></a>
</h3>
<p>There are multiple ways to explore a data set. Here are just a few
examples:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># shows first 6  rows of the data set</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># basic statistical information about each column.</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   country               year           pop             continent
 Length:1704        Min.   :1952   Min.   :6.001e+04   Length:1704
 Class :character   1st Qu.:1966   1st Qu.:2.794e+06   Class :character
 Mode  :character   Median :1980   Median :7.024e+06   Mode  :character
                    Mean   :1980   Mean   :2.960e+07
                    3rd Qu.:1993   3rd Qu.:1.959e+07
                    Max.   :2007   Max.   :1.319e+09
    lifeExp        gdpPercap
 Min.   :23.60   Min.   :   241.2
 1st Qu.:48.20   1st Qu.:  1202.1
 Median :60.71   Median :  3531.8
 Mean   :59.47   Mean   :  7215.3
 3rd Qu.:70.85   3rd Qu.:  9325.5
 Max.   :82.60   Max.   :113523.1  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Information format differes by data type.</span></span>
<span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># returns number of rows in a dataset</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span> <span class="co"># returns number of columns in a dataset</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="dollar-sign">Dollar sign ($)<a class="anchor" aria-label="anchor" href="#dollar-sign"></a>
</h3>
<p>When you’re analyzing a data set, you often need to access its
specific columns.</p>
<p>One handy way to access a column is using it’s name and a dollar sign
<code>$</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This notation means: From dataset gapminder, give me column country. You can</span></span>
<span><span class="co"># see that the column accessed in this way is just a vector of characters.</span></span>
<span><span class="va">country_vec</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">country</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">country_vec</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan"
[6] "Afghanistan"</code></pre>
</div>
<p>Note that the calling a column with a <code>$</code> sign will return
a <em>vector</em>, it’s not a data frame anymore.</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="data-frame-manipulation-with-dplyr">Data frame Manipulation with dplyr<a class="anchor" aria-label="anchor" href="#data-frame-manipulation-with-dplyr"></a>
</h1>
<div class="section level2">
<h2 id="select">Select<a class="anchor" aria-label="anchor" href="#select"></a>
</h2>
<p>Let’s start manipulating the data.</p>
<p>First, we will adapt our data set, by keeping only the columns we’re
interested in, using the <code>select()</code> function from the
<code>dplyr</code> package:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">year_country_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  year     country gdpPercap
1 1952 Afghanistan  779.4453
2 1957 Afghanistan  820.8530
3 1962 Afghanistan  853.1007
4 1967 Afghanistan  836.1971
5 1972 Afghanistan  739.9811
6 1977 Afghanistan  786.1134</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="pipe">Pipe<a class="anchor" aria-label="anchor" href="#pipe"></a>
</h2>
<p>Now, this is not the most common notation when working with
<code>dplyr</code> package. <code>dplyr</code> offers an operator
<code>%&gt;%</code> called a pipe, which allows you build up very
complicated commands in a readable way.</p>
<p>In newer installation of <code>R</code> you can also find a notation
<code>|&gt;</code> . This pipe works in a similar way. The main
difference is that you don’t need to load any packages to have it
available.</p>
<p>The <code>select()</code> statement with pipe would look like
that:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">year_country_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  year     country gdpPercap
1 1952 Afghanistan  779.4453
2 1957 Afghanistan  820.8530
3 1962 Afghanistan  853.1007
4 1967 Afghanistan  836.1971
5 1972 Afghanistan  739.9811
6 1977 Afghanistan  786.1134</code></pre>
</div>
<p>First we define data set, then - with the use of pipe we pass it on
to the <code>select()</code> function. This way we can chain multiple
functions together, which we will be doing now.</p>
</div>
<div class="section level2">
<h2 id="filter">Filter<a class="anchor" aria-label="anchor" href="#filter"></a>
</h2>
<p>We already know how to select only the needed columns. But now, we
also want to filter the rows of our data set via certain conditions with
<code>filter()</code> function. Instead of doing it in separate steps,
we can do it all together.</p>
<p>In the <code>gapminder</code> data set, we want to see the results
from outside of Europe for the 21st century.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_euro</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Europe"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span>
<span><span class="co"># '&amp;' operator (AND) - both conditions must be met</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">year_country_gdp_euro</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  year     country gdpPercap
1 2002 Afghanistan  726.7341
2 2007 Afghanistan  974.5803
3 2002     Algeria 5288.0404
4 2007     Algeria 6223.3675
5 2002      Angola 2773.2873
6 2007      Angola 4797.2313</code></pre>
</div>
<div id="challenge-filtered-data-frame" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-filtered-data-frame" class="callout-inner">
<h3 class="callout-title">Challenge: filtered data frame</h3>
<div class="callout-content">
<p>Write a single command (which can span multiple lines and includes
pipes) that will produce a data frame that has the values for life
expectancy, country and year, only for Eurasia. How many rows does your
data frame have and why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R BG-INFO<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_eurasia</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span> <span class="op">|</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span>
<span><span class="co"># '|' operator (OR) - one of the conditions must be met</span></span>
<span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">year_country_gdp_eurasia</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 756</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="group-and-summarize">Group and summarize<a class="anchor" aria-label="anchor" href="#group-and-summarize"></a>
</h2>
<p>So far, we have provided summary statistics on the whole dataset,
selected columns, and filtered the observations. But often instead of
doing that, we would like to know statistics about all of the
continents, presented by group.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="co"># select the dataset</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># group by continent</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="co"># create basic stats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
  continent avg_gdpPercap
  &lt;chr&gt;             &lt;dbl&gt;
1 Africa            2194.
2 Americas          7136.
3 Asia              7902.
4 Europe           14469.
5 Oceania          18622.</code></pre>
</div>
<div id="challenge-longest-and-shortest-life-expectancy" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-longest-and-shortest-life-expectancy" class="callout-inner">
<h3 class="callout-title">Challenge: longest and shortest life expectancy</h3>
<div class="callout-content">
<p>Calculate the average life expectancy per country. Which country has
the longest average life expectancy and which has the shortest average
life expectancy?</p>
<p><strong>Hint</strong> Use <code>max()</code> and <code>min()</code>
functions to find minimum and maximum.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R BG-INFO<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_lifeExp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">avg_lifeExp</span> <span class="op">==</span> <span class="fu">min</span><span class="op">(</span><span class="va">avg_lifeExp</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">avg_lifeExp</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">avg_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  country      avg_lifeExp
  &lt;chr&gt;              &lt;dbl&gt;
1 Iceland             76.5
2 Sierra Leone        36.8</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="multiple-groups-and-summary-variables">Multiple groups and summary variables<a class="anchor" aria-label="anchor" href="#multiple-groups-and-summary-variables"></a>
</h3>
<p>You can also group by multiple columns:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 60 × 3
# Groups:   continent [5]
   continent  year avg_gdpPercap
   &lt;chr&gt;     &lt;int&gt;         &lt;dbl&gt;
 1 Africa     1952         1253.
 2 Africa     1957         1385.
 3 Africa     1962         1598.
 4 Africa     1967         2050.
 5 Africa     1972         2340.
 6 Africa     1977         2586.
 7 Africa     1982         2482.
 8 Africa     1987         2283.
 9 Africa     1992         2282.
10 Africa     1997         2379.
# ℹ 50 more rows</code></pre>
</div>
<p>On top of this, you can also make multiple summaries of those
groups:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    avg_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>    sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>    avg_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    n_obs <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="frequencies">Frequencies<a class="anchor" aria-label="anchor" href="#frequencies"></a>
</h2>
<p>If you need only a number of observations per group, you can use the
<code>count()</code> function</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
# Groups:   continent [5]
  continent     n
  &lt;chr&gt;     &lt;int&gt;
1 Africa      624
2 Americas    300
3 Asia        396
4 Europe      360
5 Oceania      24</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="mutate">Mutate<a class="anchor" aria-label="anchor" href="#mutate"></a>
</h2>
<p>Frequently you’ll want to create new columns based on the values in
existing columns. For example, instead of only having the GDP per
capita, we might want to create a new GDP variable and convert its units
into Billions. For this, we’ll use <code>mutate()</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>gdpBillion <span class="op">=</span> <span class="va">gdpPercap</span> <span class="op">*</span> <span class="va">pop</span> <span class="op">/</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap gdpBillion
1 Afghanistan 1952  8425333      Asia  28.801  779.4453   6.567086
2 Afghanistan 1957  9240934      Asia  30.332  820.8530   7.585449
3 Afghanistan 1962 10267083      Asia  31.997  853.1007   8.758856
4 Afghanistan 1967 11537966      Asia  34.020  836.1971   9.648014
5 Afghanistan 1972 13079460      Asia  36.088  739.9811   9.678553
6 Afghanistan 1977 14880372      Asia  38.438  786.1134  11.697659</code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>We can use the <code>select()</code> and <code>filter()</code>
functions to select certain columns in a data frame and to subset it
based a specific conditions.</li>
<li>With <code>mutate()</code>, we can create new columns in a data
frame with values based on existing columns.</li>
<li>By combining <code>group_by()</code> and <code>summarize()</code> in
a pipe (<code>%&gt;%</code>) chain, we can generate summary statistics
for each group in a data frame.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section><section id="aio-04-intro-to-visualisation"><p>Content from <a href="04-intro-to-visualisation.html">Introduction to visualisation</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/04-intro-to-visualisation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create a basic plot in R?</li>
<li>How can I add features to a plot?</li>
<li>How can I get basic summary information about my data set?</li>
<li>How can I include addition information via a colours palette.</li>
<li>How can I find more information about a function and its
arguments?</li>
<li>How can I create new columns or remove existing columns from a data
frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Generate plots to visualise data with <code>ggplot2</code>.</li>
<li>Add plot layers to incrementally build a more complex plot.</li>
<li>Use the <code>fill</code> argument for colouring surfaces, and
modify colours with the viridis or scale_manual packages.</li>
<li>Explore the help documentation.</li>
<li>Save and format your plot via the <code>ggsave()</code>
function.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="introduction-to-visualisation">Introduction to Visualisation<a class="anchor" aria-label="anchor" href="#introduction-to-visualisation"></a>
</h1>
<p>The package <code>ggplot2</code> is a powerful plotting system. We
will start with an introduction of key features of <code>ggplot2</code>.
<code>gg</code> stands for grammar of graphics. The idea idea behind it
is that the following three components are needed to create a graph:</p>
<ul>
<li>data,</li>
<li>aesthetics - a coordinate system on which we map the data (what is
represented on x axis, what on y axis), and</li>
<li>geometries - visual representation of the data (points, bars,
etc.)</li>
</ul>
<p>A fun part about <code>ggplot2</code> is that you can add layers to
the plot to provide more information and to make it more beautiful.</p>
<p>In the following parts of this workshop, you will use this package to
visualize geospatial data. First, make sure that you have the following
packages loaded.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, lets plot the distribution of life expectancy in the
<code>gapminder</code> dataset:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder</span>, <span class="co"># data</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span> <span class="co"># aesthetics layer</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="co"># geometry layer</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>You can see that in <code>ggplot</code> you use <code>+</code> as a
pipe, to add layers. Within the <code>ggplot()</code> call, it is the
only pipe that will work. But, it is possible to chain operations on a
data set with a pipe that we have already learned: <code>%&gt;%</code> (
or <code>|&gt;</code>) and follow them by ggplot syntax.</p>
<p>Let’s create another plot, this time only on a subset of
observations:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="co"># we select a data set</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># filter to keep one year and one continent</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># the x and y axes represent values of columns</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="co"># we select a column graph as a geometry</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-col-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now, you can iteratively improve how the plot looks like. For
example, you might want to flip it, to better display the labels.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span></span>
<span>    <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,</span>
<span>    <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="co"># flip axes</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-coord-flip-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>One thing you might want to change here is the order in which
countries are displayed. It would be easier to compare GDP per capita,
if they were showed in order. To do that, we need to reorder factor
levels (you remember, we’ve already done this before).</p>
<p>Now the order of the levels will depend on another variable - GDP per
capita.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span></span>
<span>    <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,</span>
<span>    <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># reorder factor levels</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-color-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Let’s make things more colourful - let’s represent the average life
expectancy of a country by colour</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span></span>
<span>    <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,</span>
<span>    <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">lifeExp</span> <span class="co"># use 'fill' for surfaces; 'colour' for points and lines</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can also adapt the colour scale. Common choice that is used for
its readability and colorblind-proofness are the palettes available in
the <code>viridis</code> package.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span></span>
<span>    <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,</span>
<span>    <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, fill <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="co"># _c stands for continuous scale</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-colors-adapt-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Maybe we don’t need that much information about the life expectancy.
We only want to know if it’s below or above average. We will make use of
the <code>if_else()</code> function inside <code>mutate()</code> to
create a new column <code>lifeExpCat</code> with the value
<code>high</code> if life expectancy is above average and
<code>low</code> otherwise. Note the usage of the <code>if_else()</code>
function:
<code>if_else(&lt;condition&gt;, &lt;value if TRUE&gt;, &lt;value if FALSE&gt;)</code>.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="co"># this time let's save the plot in an object</span></span>
<span>  <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span></span>
<span>    <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    country <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>    lifeExpCat <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>      <span class="va">lifeExp</span> <span class="op">&gt;=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      <span class="st">"high"</span>,</span>
<span>      <span class="st">"low"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, fill <span class="op">=</span> <span class="va">lifeExpCat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>      <span class="st">"light blue"</span>,</span>
<span>      <span class="st">"orange"</span></span>
<span>    <span class="op">)</span> <span class="co"># customize the colors</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Since we saved a plot as an object <code>p</code>, nothing has been
printed out. Just like with any other object in <code>R</code>, if you
want to see it, you need to call it.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-call-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now we can make use of the saved object and add things to it.</p>
<p>Let’s also give it a title and name the axes:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"GDP per capita in Americas"</span>, subtitle <span class="op">=</span> <span class="st">"Year 2007"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Country"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"GDP per capita"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show plot</span></span>
<span><span class="va">p</span></span></code></pre>
</div>
<figure><img src="../fig/04-intro-to-visualisation-rendered-ggplot-titles-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div class="section level1">
<h1 id="writing-data">Writing data<a class="anchor" aria-label="anchor" href="#writing-data"></a>
</h1>
<div class="section level2">
<h2 id="saving-the-plot">Saving the plot<a class="anchor" aria-label="anchor" href="#saving-the-plot"></a>
</h2>
<p>Once we are happy with our plot we can save it in a format of our
choice. Remember to save it in the dedicated folder.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span></span>
<span>  plot <span class="op">=</span> <span class="va">p</span>,</span>
<span>  filename <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fig_output"</span>, <span class="st">"plot_americas_2007.pdf"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># By default, ggsave() saves the last displayed plot, but</span></span>
<span><span class="co"># you can also explicitly name the plot you want to save</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="using-help-documentation">Using help documentation<a class="anchor" aria-label="anchor" href="#using-help-documentation"></a>
</h3>
<p>My saved plot is not very readable. We can see why it happened by
exploring the help documentation. We can do that by writing directly in
the console:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">ggsave</span></span></code></pre>
</div>
<p>We can read that it uses the “size of the current graphics device”.
That would explain why our saved plots look slightly different. Feel
free to explore the documentation to see how to adapt the size e.g. by
adapting <code>width</code>, <code>height</code> and <code>units</code>
parameter.</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-the-data">Saving the data<a class="anchor" aria-label="anchor" href="#saving-the-data"></a>
</h2>
<p>Another output of your work you want to save is a cleaned data set.
In your analysis, you can then load directly that data set. Let’s say we
want to save the data only for Americas:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_amr_2007</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    country_reordered <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>    lifeExpCat <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">write.csv</span><span class="op">(</span><span class="va">gapminder_amr_2007</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data_output"</span>, <span class="st">"gapminder_americas_2007.csv"</span><span class="op">)</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>With <code>ggplot2</code>, we use the <code>+</code> operator to
combine plot layers and incrementally build a more complex plot.</li>
<li>In the aesthetics (<code>aes()</code>), we can assign variables to
the x and y axes and use the <code>fill</code> argument for colouring
surfaces.</li>
<li>With <code>scale_fill_viridis_c()</code> and
<code>scale_fill_manual()</code> we can assign new colours to our
plot.</li>
<li>To open the help documentation for a function, we run the name of
the function preceded by the <code>?</code> sign.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section><section id="aio-08-intro-to-geospatial-concepts"><p>Content from <a href="08-intro-to-geospatial-concepts.html">Introduction to Geospatial Concepts</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/08-intro-to-geospatial-concepts.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I describe the location of a geographic feature on the
surface of the earth?</li>
<li>What is a coordinate reference system (CRS) and how do I describe
different types of CRS?</li>
<li>How do I decide on what CRS to use?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Identify the CRS that is best fit for a specific research
question.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="the-shape-of-the-earth">The shape of the Earth<a class="anchor" aria-label="anchor" href="#the-shape-of-the-earth"></a>
</h2>
<hr class="half-width">
<p>The shape of the Earth is approximately a sphere which is slightly
wider than it is tall, and which is called <strong>ellipsoid</strong>.
The true shape of the Earth is an irregular ellipsoid, the so-called
<strong>geoid</strong>, as illustrated in the image below.</p>
<figure style="text-align: center"><img src="https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/_ImagesModules/_selfstudy/S06_images/S06_03_a00.jpg" alt="The shape of the Earth. Source: United Nations Statistics Division and International Cartographic Association (2012)." class="figure mx-auto d-block"><figcaption>
The shape of the Earth. Source: United Nations Statistics Division and
International Cartographic Association (2012).
</figcaption></figure><p>The most common and basic representation of the position of points on
the Earth is the combination of the <strong>geographical latitude and
longitude</strong>, as shown below.</p>
<figure style="text-align: center"><img src="../fig/latlon.png" alt="Geographical latitude and longitude. Source: van der Marel (2014)." width="713" class="figure mx-auto d-block"><figcaption>
Geographical latitude and longitude. Source: van der Marel (2014).
</figcaption></figure><p><strong>Meridians</strong> are <strong>vertical</strong> circles with
constant longitude, called <strong>great circles</strong>, which run
from the North Pole to the South Pole. <strong>Parallels</strong> are
<strong>horizontal</strong> circles with constant latitude, which are
called <strong>small circles</strong>. Only the equator (the largest
parallel) is also a great circle.</p>
<p>The black lines in the figure above show the equator and the prime
meridian running through Greenwich, with latitude and longitude labels.
The red dotted lines show the meridian and parallel running through
Karachi, Pakistan (25°45’N, 67°01’E).</p>
</section><section><h2 class="section-heading" id="map-projection-from-the-3d-earth-to-a-2d-map">Map projection: From the 3D Earth to a 2D map<a class="anchor" aria-label="anchor" href="#map-projection-from-the-3d-earth-to-a-2d-map"></a>
</h2>
<hr class="half-width">
<p><strong>Map projection</strong> is a systematic transformation of the
latitudes and longitudes of locations on the surface of an ellipsoid
into locations on a plane. It is a transformation of the
three-dimensional Earth’s surface into its two-dimensional
representation on a sheet of paper or computer screen (see the image
below for a comparison with flattening an orange peel).</p>
<figure style="text-align: center"><img src="https://datacarpentry.org/organization-geospatial/fig/orange-peel-earth.jpg" alt="Map projection represented as flattening an orange peel. Source: Data Carpentry (2023)." class="figure mx-auto d-block"><figcaption>
Map projection represented as flattening an orange peel. Source: Data
Carpentry (2023).
</figcaption></figure><p>Many different map projections are in use for different purposes.
Generally, they can be categorised into the following groups:
cylindrical, conic, and azimuthal.</p>
<figure style="text-align: center"><img src="https://kartoweb.itc.nl/geometrics/Bitmaps/Intro%201.9a.gif" alt="Cylindrical, conic, and azimuthal map projections. Source: Knippers (2009)." class="figure mx-auto d-block"><figcaption>
Cylindrical, conic, and azimuthal map projections. Source: Knippers
(2009).
</figcaption></figure><p>Each map projection introduces a <strong>distortion</strong> in
geometrical elements – <strong>distance, angle, and area</strong>.
Depending on which of these geometrical elements are more relevant for a
specific map, we can choose an appropriate map projection.
<strong>Conformal projections</strong> are the best for preserving
angles between any two curves, which means preserving the correct shapes
of small areas; <strong>equal area (equivalent) projections</strong>
preserve the area or scale; <strong>equal distance (conventional)
projections</strong> are the best for preserving distances.</p>
</section><section><h2 class="section-heading" id="coordinate-reference-systems-crs">Coordinate reference systems (CRS)<a class="anchor" aria-label="anchor" href="#coordinate-reference-systems-crs"></a>
</h2>
<hr class="half-width">
<p><strong>A coordinate reference system (CRS)</strong> is a
coordinate-based local, regional or global system for locating
geographical entities, which uses a specific map projection. It defines
how the two-dimensional, projected map relates to real places on the
Earth.</p>
<p>All coordinate reference systems are included in a public registry
called the <strong>EPSG Geodetic Parameter Dataset (EPSG
registry)</strong>, initiated in 1985 by a member of the European
Petroleum Survey Group (EPSG). Each CRS has a unique <strong>EPSG
code</strong>, which makes it possible to easily identify them among the
large number of CRS. This is particularly important for transforming
spatial data from one CRS to another.</p>
<p>Some of the most commonly used CRS in the Netherlands are the
following:</p>
<ul>
<li>
<strong>World Geodetic System 1984 (WGS84)</strong> is the best
known global reference system <strong>(EPSG:4326)</strong>.</li>
<li>
<strong>European Terrestrial Reference System 1989 (ETRS89)</strong>
is the standard coordinate system for Europe
<strong>(EPSG:4258)</strong>.</li>
<li>The most popular projected CRS in the Netherlands is ‘Stelsel van de
Rijksdriehoeksmeting (RD)’ registered in EPSG as <strong>‘Amersfoort /
RD New’ (EPSG:28992)</strong>.</li>
</ul>
<p>The main parameters of each CRS are the following:</p>
<ul>
<li>
<strong>Datum</strong> is a model of the shape of the Earth, which
specifies how a coordinate system is linked to the Earth, e.g. how to
define the origin of the coordinate axis – where (0,0) is. It has
angular units (degrees).</li>
<li>
<strong>Projection</strong> is mathematical transformation of the
angular measurements on the Earth to linear units (e.g. meters) on a
flat surface (paper or a computer screen).</li>
<li>
<strong>Additional parameters</strong>, such as a definition of the
centre of the map, are often necessary to create the full CRS.</li>
</ul>
<p>If you work with data for the Netherlands, you will most likely
encounter the two CRS shown in the table below, namely the WGS 84 and
Amersfoort / RD New. While WGS 84 is used for data for countries
worldwide (for example, for OpenStreetMap data), Amersfoort / RD New is
a Dutch local CRS. For other countries, other local CRS are
available.</p>
<table class="table">
<caption>Main properties of WGS 84 and Amersfoort / RD New coordinate
reference systems</caption>
<colgroup>
<col width="25%">
<col width="37%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>WGS 84 (EPSG:4326)</th>
<th>Amersfoort / RD New (EPSG:28992)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Definition</td>
<td>Dynamic (relies on a datum which is not plate-fixed)</td>
<td>Static (relies on a datum which is plate-fixed)</td>
</tr>
<tr class="even">
<td>Celestial body</td>
<td>Earth</td>
<td>Earth</td>
</tr>
<tr class="odd">
<td>Ellipsoid</td>
<td>WGS-84</td>
<td>Bessel 1841</td>
</tr>
<tr class="even">
<td>Prime meridian</td>
<td>International Reference Meridian</td>
<td>Greenwich</td>
</tr>
<tr class="odd">
<td>Datum</td>
<td>World Geodetic System 1984 ensemble</td>
<td>Amersfoort</td>
</tr>
<tr class="even">
<td>Projection</td>
<td>Geographic (uses latitude and longitude for coordinates)</td>
<td>Projected (uses meters for coordinates)</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>Lat/long (Geodetic alias)</td>
<td>Oblique Stereographic Alternative</td>
</tr>
<tr class="even">
<td>Units</td>
<td>Degrees</td>
<td>Meters</td>
</tr>
</tbody>
</table>
<p>The figure below shows the same city (Rotterdam) in these two
CRS.</p>
<figure style="text-align: center"><img src="../fig/rotterdam-crs.png" alt="Rotterdam in two different CRS" width="1631" class="figure mx-auto d-block"><figcaption>
Rotterdam in two different CRS
</figcaption></figure><p>In addition to using different CRS, these two maps of Rotterdam also
have different scales.</p>
</section><section><h2 class="section-heading" id="map-scale">Map scale<a class="anchor" aria-label="anchor" href="#map-scale"></a>
</h2>
<hr class="half-width">
<p><strong>Map scale</strong> measures the ratio between distance on a
map and the corresponding distance on the ground. For example, on a
1:100 000 scale map, 1cm on the map equals 1km (100 000 cm) on the
ground. Map scale can be expressed in the following three ways:</p>
<table class="table"><tbody>
<tr class="odd">
<td>Verbal:</td>
<td>1 centimetre represents 250 meters</td>
</tr>
<tr class="even">
<td>Fraction:</td>
<td>1:25000</td>
</tr>
<tr class="odd">
<td>Graphic:</td>
<td><img src="../fig/scalebar.png" style="width:75.0%" class="figure"></td>
</tr>
</tbody></table>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Note that the maps presented in this lesson do not use a scale bar.
Instead, plot axes will serve that purpose.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="types-of-geospatial-data">Types of geospatial data<a class="anchor" aria-label="anchor" href="#types-of-geospatial-data"></a>
</h2>
<hr class="half-width">
<p>The map of Rotterdam in the figure above shows the area of the city
as a discrete feature with precise boundaries. This type of data is
called vector. Vector data can have the form of points, lines and
polygons (areas).</p>
<figure style="text-align: center"><img src="../fig/vector-raster-1.png" alt="Same geographical area as raster and vector data" width="419" class="figure mx-auto d-block"><figcaption>
Same geographical area as raster and vector data
</figcaption></figure><p>We can also represent geographical features on the Earth as
continuous phenomena and images of the Earth. This type of data is
called raster. The figure below shows the two types of geospatial data
which can be used to represent the real world, namely vector and
raster.</p>
<figure style="text-align: center"><img src="../fig/vector-raster-2.png" alt="Same geographical area as raster and vector data (Source: Saab, 2003)" width="971" class="figure mx-auto d-block"><figcaption>
Same geographical area as raster and vector data (Source: Saab, 2003)
</figcaption></figure><div id="disambiguating-vectors" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="disambiguating-vectors" class="callout-inner">
<h3 class="callout-title">Disambiguating vectors</h3>
<div class="callout-content">
<p>Vector data in geospatial analysis is not the same as vectors in R.
In R, vectors are one-dimensional arrays of elements of the same type,
while geospatial vector data is a type of data that represents discrete
features with precise boundaries.</p>
</div>
</div>
</div>
<div id="challenge-crs-for-calculating-areas" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-crs-for-calculating-areas" class="callout-inner">
<h3 class="callout-title">Challenge: CRS for calculating areas</h3>
<div class="callout-content">
<p>You want to investigate which European country has the largest urban
area. Which CRS will you use?</p>
<ol style="list-style-type: lower-alpha">
<li>EPSG:4326</li>
<li>EPSG:28992</li>
<li>EPSG:3035</li>
</ol>
<p>Hint: Go to <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> or <a href="https://epsg.org/search/by-name" class="external-link uri">https://epsg.org/search/by-name</a> and check properties of
the given CRS, such as datum, type of map projection, units of measure
etc.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Correct answer: c. EPSG:3035</p>
</div>
</div>
</div>
</div>
<div id="challenge-crs-for-calculating-shortest-paths" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-crs-for-calculating-shortest-paths" class="callout-inner">
<h3 class="callout-title">Challenge: CRS for calculating shortest paths</h3>
<div class="callout-content">
<p>You want to calculate the shortest path between two buildings in
Delft. Which CRS will you use?</p>
<ol style="list-style-type: lower-alpha">
<li>EPSG:4326</li>
<li>EPSG:28992</li>
<li>EPSG:3035</li>
</ol>
<p>Hint: Go to <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> or <a href="https://epsg.org/search/by-name" class="external-link uri">https://epsg.org/search/by-name</a> and check properties of
the given CRS, such as datum, type of map projection, units of measure
etc.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Correct answer: b. EPSG:28992</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<hr class="half-width">
<ul>
<li><p>Knippers, R. (2009): Geometric aspects of mapping. International
Institute for Geo-Information Science and Earth Observation (ITC),
Enschede. <a href="https://kartoweb.itc.nl/geometrics/" class="external-link uri">https://kartoweb.itc.nl/geometrics/</a> (Accessed
22-01-2024)</p></li>
<li><p>Saab, D. J. (2003). Conceptualizing space: Mapping schemas as
meaningful representations. Unpublished Master’s Thesis, Lesley
University, Cambridge, MA, <a href="http://www.djsaab.info/thesis/djsaab_thesis.pdf" class="external-link uri">http://www.djsaab.info/thesis/djsaab_thesis.pdf</a>.</p></li>
<li><p>United Nations Statistics Division and International Cartographic
Association (2012): 3. Plane rectangular coordinate systems – A) The
ellipsoid / geoid. <a href="https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/_HtmlModules/_Selfstudy/S06/S06_03a.html" class="external-link uri">https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/_HtmlModules/_Selfstudy/S06/S06_03a.html</a>
(Accessed 22-01-2024)</p></li>
<li><p>Van der Marel, H. (2014). Reference systems for surveying and
mapping. Lecture notes. Faculty of Civil Engineering and Geosciences,
Delft University of Technology, Delft, The Netherlands. <a href="https://gnss1.tudelft.nl/pub/vdmarel/reader/CTB3310_RefSystems_1-2a_print.pdf" class="external-link uri">https://gnss1.tudelft.nl/pub/vdmarel/reader/CTB3310_RefSystems_1-2a_print.pdf</a>
(Accessed 22-01-2024)</p></li>
</ul>
<div id="useful-resources" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="useful-resources" class="callout-inner">
<h3 class="callout-title">Useful resources</h3>
<div class="callout-content">
<ul>
<li><p>Campbell, J., Shin, M. E. (2011). Essentials of Geographic
Information Systems. Textbooks. 2. <a href="https://digitalcommons.liberty.edu/textbooks/2" class="external-link uri">https://digitalcommons.liberty.edu/textbooks/2</a> (Accessed
22-01-2024)</p></li>
<li><p>Data Carpentry (2023): Introduction to Geospatial Concepts.
Coordinate Reference Systems. <a href="https://datacarpentry.org/organization-geospatial/03-crs.html" class="external-link uri">https://datacarpentry.org/organization-geospatial/03-crs.html</a>
(Accessed 22-01-2024)</p></li>
<li><p>GeoRepository (2024): EPSG Geodetic Parameter Dataset <a href="https://epsg.org/home.html" class="external-link uri">https://epsg.org/home.html</a> (Accessed
22-01-2024)</p></li>
<li><p>Klokan Technologies GmbH (2022) <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> (Accessed 22-01-2024)</p></li>
<li><p>United Nations Statistics Division and International Cartographic
Association (2012b): UNGEGN-ICA webcourse on Toponymy. <a href="https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/2012_Home.html" class="external-link uri">https://unstats.un.org/unsd/geoinfo/ungegn/docs/_data_icacourses/2012_Home.html</a>
(Accessed 22-01-2024)</p></li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li><p>Each location on the Earth has its geographical latitude and
longitude, which can be transformed on a plane using a map
projection.</p></li>
<li><p>Depending on the research question, we need a global, regional,
or local CRS with suitable properties such as the least possible
distortion and an appropriate measurement unit.</p></li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-09-open-and-plot-vector-layers"><p>Content from <a href="09-open-and-plot-vector-layers.html">Open and Plot Vector Layers</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/09-open-and-plot-vector-layers.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I read, examine and visualize point, line and polygon vector
data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Differentiate between point, line, and polygon vector data.</li>
<li>Load vector data into R.</li>
<li>Access the attributes of a vector object in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Make sure that the <code>sf</code> package and its dependencies are
installed before the workshop. The installation can be lengthy, so
allocate enough extra time before the workshop for solving installation
problems. We recommend one or two installation ‘walk-in’ hours on a day
before the workshop. Also, 15-30 minutes at the beginning of the first
workshop day should be enough to tackle last-minute installation
issues.</p>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite</h3>
<div class="callout-content">
<p>In this lesson you will work with the <code>sf</code> package. Note
that the <code>sf</code> package has some external dependencies, namely
GEOS, PROJ.4, GDAL and UDUNITS, which need to be installed beforehand.
Before starting the lesson, follow the workshop <a href="index.html#setup">setup instructions</a> for the installation of
<code>sf</code> and its dependencies.</p>
</div>
</div>
</div>
<p>First we need to load the packages we will use in this lesson. We
will use the <code>tidyverse</code> package with which you are already
familiar from the previous lesson. In addition, we need to load the <a href="https://r-spatial.github.io/sf/" class="external-link"><code>sf</code></a> package for
working with spatial vector data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>  <span class="co"># wrangle, reshape and visualize data</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span>         <span class="co"># work with spatial vector data</span></span></code></pre>
</div>
<div id="the-sf-package" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-sf-package" class="callout-inner">
<h3 class="callout-title">The ‘sf’ package</h3>
<div class="callout-content">
<p><code>sf</code> stands for Simple Features which is a standard
defined by the Open Geospatial Consortium for storing and accessing
geospatial vector data. Read more about simple features and its
implementation in R <a href="https://r-spatial.github.io/sf/articles/sf1.html" class="external-link">here</a>.</p>
</div>
</div>
</div>
<div id="geometry-in-qgis-and-in-r" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="geometry-in-qgis-and-in-r" class="callout-inner">
<h3 class="callout-title">Geometry in QGIS and in R</h3>
<div class="callout-content">
<p>You may be familiar with GIS software using graphical interfaces like
QGIS. In QGIS, you do not see the geometry in the Attribute Table but it
is directly displayed in the map view. In R, however, the geometry is
stored in a column called <code>geometry</code>.</p>
<figure><img src="../fig/geometry-qgis.png" alt="Geometry in QGIS" class="figure mx-auto d-block"><div class="figcaption">Geometry in QGIS</div>
</figure><figure><img src="../fig/geometry-r.png" alt="Geometry in R" class="figure mx-auto d-block"><div class="figcaption">Geometry in R</div>
</figure>
</div>
</div>
</div>
<section><h2 class="section-heading" id="import-shapefiles">Import shapefiles<a class="anchor" aria-label="anchor" href="#import-shapefiles"></a>
</h2>
<hr class="half-width">
<p>Let’s start by opening a shapefile. Shapefiles are a common file
format to store spatial vector data used in GIS software. Note that a
shapefile consists of multiple files and it is important to keep them
all together in the same location. We will read a shapefile with the
administrative boundary of Delft with the function
<code>st_read()</code> from the <code>sf</code> package.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div id="all-sf-functions-start-with-st_" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="all-sf-functions-start-with-st_" class="callout-inner">
<h3 class="callout-title">All ‘sf’ functions start with ‘st_’</h3>
<div class="callout-content">
<p>Note that all functions from the <code>sf</code> package start with
the standard prefix <code>st_</code> which stands for Spatial Type. This
is helpful in at least two ways:</p>
<ol style="list-style-type: decimal">
<li>it allows for easy autocompletion of function names in RStudio,
and</li>
<li>it makes the interaction with or translation to/from software using
the simple features standard like PostGIS easy.</li>
</ol>
</div>
</div>
</div>
<div id="shapefiles-vs.-geopackage" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="shapefiles-vs.-geopackage" class="callout-inner">
<h3 class="callout-title">Shapefiles vs. GeoPackage</h3>
<div class="callout-content">
<p>Shapefiles are increasingly being replaced by more modern formats
like GeoPackage. An advantage of GeoPackage is that it is a single file
that can store multiple layers and attributes, whereas shapefiles
consist of multiple files. However, shapefiles are still widely used and
are a good starting point for learning about spatial data.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="spatial-metadata">Spatial Metadata<a class="anchor" aria-label="anchor" href="#spatial-metadata"></a>
</h2>
<hr class="half-width">
<p>By default (with <code>quiet = FALSE</code>), the
<code>st_read()</code> function provides a message with a summary of
metadata about the file that was read in.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-boundary' from data source
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-boundary.shp'
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 4.320218 ymin: 51.96632 xmax: 4.407911 ymax: 52.0326
Geodetic CRS:  WGS 84</code></pre>
</div>
<p>To examine the metadata in more detail, we can use other, more
specialised, functions from the <code>sf</code> package. The
<code>st_geometry_type()</code> function, for instance, gives us
information about the geometry type, which in this case is
<code>POLYGON</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POLYGON
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<div id="geometry-types" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="geometry-types" class="callout-inner">
<h3 class="callout-title">Geometry types</h3>
<div class="callout-content">
<p>The <code>sf</code> package supports the following common geometry
types: <code>POINT</code>, <code>LINESTRING</code>,
<code>POLYGON</code>, <code>MULTIPOINT</code>,
<code>MULTILINESTRING</code>, <code>MULTIPOLYGON</code>,
<code>GEOMETRYCOLLECTION</code>. More information about support for
these and other geometry types can be found in the <a href="https://r-spatial.github.io/sf/articles/sf1.html" class="external-link">sf package
documentation</a>.</p>
</div>
</div>
</div>
<p>The <code>st_crs()</code> function returns the coordinate reference
system (CRS) used by the shapefile, which in this case is
<code>WGS 84</code> and has the unique reference code
<code>EPSG: 4326</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
<div id="examining-the-output-of-st_crs" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="examining-the-output-of-st_crs" class="callout-inner">
<h3 class="callout-title">Examining the output of ‘st_crs()’</h3>
<div class="callout-content">
<p>As the output of <code>st_crs()</code> can be long, you can use
<code>$Name</code> and <code>$epsg</code> after the <code>crs()</code>
call to extract the projection name and EPSG code respectively.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">Name</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "WGS 84"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4326</code></pre>
</div>
<p>The <code>$</code> operator is used to extract a specific part of an
object. We used it in a <a href="03-explore-data.html">previous
episode</a> to subset a data frame by column name. In this case, it is
used to extract named elements stored in a <code>crs</code> object. For
more information, see <a href="https://r-spatial.github.io/sf/reference/st_crs.html#details" class="external-link">the
documentation of the <code>st_crs</code> function</a>.</p>
</div>
</div>
</div>
<p>The <code>st_bbox()</code> function shows the extent of the
layer.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax
 4.320218 51.966316  4.407911 52.032599 </code></pre>
</div>
<p>As <code>WGS 84</code> is a <strong>geographic CRS</strong>, the
extent of the shapefile is displayed in degrees. We need a
<strong>projected CRS</strong>, which in the case of the Netherlands is
the <code>Amersfoort / RD New</code> projection. To reproject our
shapefile, we will use the <code>st_transform()</code> function. For the
<code>crs</code> argument we can use the EPSG code of the CRS we want to
use, which is <code>28992</code> for the <code>Amersfort / RD New</code>
projection. To check the EPSG code of any CRS, we can check this
website: <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a></p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">boundary_Delft</span>, crs <span class="op">=</span> <span class="fl">28992</span><span class="op">)</span></span>
<span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">Name</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Amersfoort / RD New"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<p>Notice that the bounding box is measured in meters after the
transformation. The <code>$units_gdal</code> named element confirms that
the new CRS uses metric units.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax
 81743.00 442446.21  87703.78 449847.95 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">units_gdal</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "metre"</code></pre>
</div>
<p>We confirm the transformation by examining the reprojected
shapefile.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 81743 ymin: 442446.2 xmax: 87703.78 ymax: 449848
Projected CRS: Amersfoort / RD New
  osm_id                       geometry
1 324269 POLYGON ((87703.78 442651, ...</code></pre>
</div>
<div id="callout7" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Read more about Coordinate Reference Systems <a href="08-intro-to-geospatial-concepts.html">in the previous episode</a>.
We will also practice transformation between CRS in <a href="12-handling-spatial-projection-and-crs.html">Handling Spatial
Projection &amp; CRS</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="plot-a-vector-layer">Plot a vector layer<a class="anchor" aria-label="anchor" href="#plot-a-vector-layer"></a>
</h2>
<hr class="half-width">
<p>Now, let’s plot this shapefile. You are already familiar with the
<code>ggplot2</code> package from <a href="04-intro-to-visualisation.html">Introduction to Visualisation</a>.
<code>ggplot2</code> has special <code>geom_</code> functions for
spatial data. We will use the <code>geom_sf()</code> function for
<code>sf</code> data. We use <code>coord_sf()</code> to ensure that the
coordinates shown on the two axes are displayed in meters.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"cyan1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Delft Administrative Boundary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span> <span class="co"># displays the axes in meters</span></span></code></pre>
</div>
<figure><img src="../fig/09-open-and-plot-vector-layers-rendered-plot-boundary-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-import-line-and-point-vector-layers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-import-line-and-point-vector-layers" class="callout-inner">
<h3 class="callout-title">Challenge: Import line and point vector layers</h3>
<div class="callout-content">
<p>Read in <code>delft-streets.shp</code> and
<code>delft-leisure.shp</code> and assign them to
<code>lines_Delft</code> and <code>points_Delft</code> respectively.
Answer the following questions:</p>
<ol style="list-style-type: decimal">
<li>What is the CRS and extent for each object?</li>
<li>Do the files contain points, lines, or polygons?</li>
<li>How many features are in each file?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-streets.shp"</span><span class="op">)</span></span>
<span><span class="va">points_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-leisure.shp"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can check the type of type of geometry with the
<code>st_geometry_type()</code> function. <code>lines_Delft</code>
contains <code>"LINESTRING"</code> geometry and
<code>points_Delft</code> is made of <code>"POINT"</code>
geometries.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] LINESTRING
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">points_Delft</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POINT
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<p>Both <code>lines_Delft</code> and <code>points_Delft</code> are in
<code>EPSG:28992</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">points_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<p>When looking at the bounding boxes with the <code>st_bbox()</code>
function, we see the spatial extent of the two objects in a projected
CRS using meters as units. <code>lines_Delft()</code> and
<code>points_Delft</code> have similar extents.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax
 81759.58 441223.13  89081.41 449845.81 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">points_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax
 81863.21 442621.15  87370.15 449345.08 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Metadata for vector layers include geometry type, CRS, and extent
and can be examined with the <code>sf</code> functions
<code>st_geometry_type()</code>, <code>st_crs()</code>, and
<code>st_bbox()</code>, respectively.</li>
<li>Load spatial objects into R with the <code>sf</code> function
<code>st_read()</code>.</li>
<li>Spatial objects can be plotted directly with <code>ggplot2</code>
using the <code>geom_sf()</code> function. No need to convert to a data
frame.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-10-explore-and-plot-by-vector-layer-attributes"><p>Content from <a href="10-explore-and-plot-by-vector-layer-attributes.html">Explore and plot by vector layer attributes</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/10-explore-and-plot-by-vector-layer-attributes.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 50 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I examine the attributes of a vector layer?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li><p>Query attributes of a vector object.</p></li>
<li><p>Subset vector objects using specific attribute values.</p></li>
<li><p>Plot a vector feature, coloured by unique attribute
values.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="query-vector-feature-metadata">Query Vector Feature Metadata<a class="anchor" aria-label="anchor" href="#query-vector-feature-metadata"></a>
</h1>
<p>Let’s have a look at the content of the loaded data, starting with
<code>lines_Delft</code>. In essence, an <code>"sf"</code> object is a
data.frame with a “sticky” geometry column and some extra metadata, like
the CRS, extent and geometry type we examined earlier.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 11244 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 81759.58 ymin: 441223.1 xmax: 89081.41 ymax: 449845.8
Projected CRS: Amersfoort / RD New
First 10 features:
    osm_id  highway                       geometry
1  4239535 cycleway LINESTRING (86399.68 448599...
2  4239536 cycleway LINESTRING (85493.66 448740...
3  4239537 cycleway LINESTRING (85493.66 448740...
4  4239620  footway LINESTRING (86299.01 448536...
5  4239621  footway LINESTRING (86307.35 448738...
6  4239674  footway LINESTRING (86299.01 448536...
7  4310407  service LINESTRING (84049.47 447778...
8  4310808    steps LINESTRING (84588.83 447828...
9  4348553  footway LINESTRING (84527.26 447861...
10 4348575  footway LINESTRING (84500.15 447255...</code></pre>
</div>
<p>This means that we can examine and manipulate them as data frames.
For instance, we can look at the number of variables (columns in a data
frame) with <code>ncol()</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>In the case of <code>point_Delft</code> those columns are
<code>"osm_id"</code>, <code>"highway"</code> and
<code>"geometry"</code>. We can check the names of the columns with the
function <code>names()</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "osm_id"   "highway"  "geometry"</code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Note that in R the geometry is just another column and counts towards
the number returned by <code>ncol()</code>. This is different from GIS
software with graphical user interfaces, where the geometry is displayed
in a viewport not as a column in the attribute table.</p>
</div>
</div>
</div>
<p>We can also preview the content of the object by looking at the first
6 rows with the <code>head()</code> function, which in the case of an
<code>sf</code> object is similar to examining the object directly.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 85107.1 ymin: 448400.3 xmax: 86399.68 ymax: 449076.2
Projected CRS: Amersfoort / RD New
   osm_id  highway                       geometry
1 4239535 cycleway LINESTRING (86399.68 448599...
2 4239536 cycleway LINESTRING (85493.66 448740...
3 4239537 cycleway LINESTRING (85493.66 448740...
4 4239620  footway LINESTRING (86299.01 448536...
5 4239621  footway LINESTRING (86307.35 448738...
6 4239674  footway LINESTRING (86299.01 448536...</code></pre>
</div>
<div class="section level2">
<h2 id="explore-values-within-one-attribute">Explore values within one attribute<a class="anchor" aria-label="anchor" href="#explore-values-within-one-attribute"></a>
</h2>
<p>Using the <code>$</code> operator, we can examine the content of a
single field of our lines object. Let’s have a look at the
<code>highway</code> field, a categorical variable stored in the
<code>lines_Delft</code> object as <code>character</code>. To avoid
displaying all 11244 values of <code>highway</code>, we will preview it
with the <code>head()</code> function:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway" "cycleway" "cycleway" "footway"  "footway"  "footway"
 [7] "service"  "steps"    "footway"  "footway" </code></pre>
</div>
<p>The first rows returned by the <code>head()</code> function do not
necessarily contain all unique values within the <code>highway</code>
field. To see all unique values, we can use the <code>unique()</code>
function. This function extracts all possible values of a character
variable. For the <code>highway</code> field, this returns all types of
roads stored in <code>lines_Delft</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"
 [5] "residential"    "unclassified"   "construction"   "secondary"
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"
[13] "track"          "motorway"       "path"           "pedestrian"
[17] "primary"        "bridleway"      "trunk"          "tertiary_link"
[21] "services"       "secondary_link" "trunk_link"     "primary_link"
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>R is also able to handle categorical variables called factors,
introduced in <a href="02-data-structures.html">an earlier episode</a>.
With factors, we can use the <code>levels()</code> function to show
unique values. To examine unique values of the <code>highway</code>
variable this way, we have to first transform it into a factor with the
<code>factor()</code> function:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">levels</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "bridleway"      "busway"         "construction"   "cycleway"
 [5] "footway"        "living_street"  "motorway"       "motorway_link"
 [9] "path"           "pedestrian"     "platform"       "primary"
[13] "primary_link"   "proposed"       "residential"    "secondary"
[17] "secondary_link" "service"        "services"       "steps"
[21] "tertiary"       "tertiary_link"  "track"          "trunk"
[25] "trunk_link"     "unclassified"  </code></pre>
</div>
<p>Note that this way the values are shown by default in alphabetical
order and <code>NA</code>s are not displayed, whereas using
<code>unique()</code> returns unique values in the order of their
occurrence in the data frame and it also shows <code>NA</code>
values.</p>
</div>
</div>
</div>
<div id="challenge-attributes-for-different-spatial-classes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-attributes-for-different-spatial-classes" class="callout-inner">
<h3 class="callout-title">Challenge: Attributes for different spatial classes</h3>
<div class="callout-content">
<!-- 3 minutes -->
<p>Explore the attributes associated with the <code>point_Delft</code>
spatial object.</p>
<ol style="list-style-type: decimal">
<li>How many fields does it have?</li>
<li>What types of leisure points do the points represent? Give three
examples.</li>
<li>Which of the following is NOT a field of the
<code>point_Delft</code> object?</li>
</ol>
<ol style="list-style-type: upper-alpha">
<li>
<code>location</code> B) <code>leisure</code> C)
<code>osm_id</code>
</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To find the number of fields, we use the <code>ncol()</code>
function:</li>
</ol>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>The types of leisure point are in the column named
<code>leisure</code>.</li>
</ol>
<p>Using the <code>head()</code> function which displays 6 rows by
default, we only see two values and <code>NA</code>s.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 83839.59 ymin: 443827.4 xmax: 84967.67 ymax: 447475.5
Projected CRS: Amersfoort / RD New
     osm_id      leisure                  geometry
1 472312297 picnic_table POINT (84144.72 443827.4)
2 480470725       marina POINT (84967.67 446120.1)
3 484697679         &lt;NA&gt; POINT (83912.28 447431.8)
4 484697682         &lt;NA&gt; POINT (83895.43 447420.4)
5 484697691         &lt;NA&gt;   POINT (83839.59 447455)
6 484697814         &lt;NA&gt; POINT (83892.53 447475.5)</code></pre>
</div>
<p>We can increase the number of rows with the <code>n</code> argument
(e.g., <code>head(n = 10)</code> to show 10 rows) until we see at least
three distinct values in the leisure column. Note that printing an
<code>sf</code> object will also display the first 10 rows.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># you might be lucky to see three distinct values</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">point_Delft</span>, <span class="fl">10</span><span class="op">)</span>  </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 10 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 82485.72 ymin: 443827.4 xmax: 85385.25 ymax: 448341.3
Projected CRS: Amersfoort / RD New
       osm_id       leisure                  geometry
1   472312297  picnic_table POINT (84144.72 443827.4)
2   480470725        marina POINT (84967.67 446120.1)
3   484697679          &lt;NA&gt; POINT (83912.28 447431.8)
4   484697682          &lt;NA&gt; POINT (83895.43 447420.4)
5   484697691          &lt;NA&gt;   POINT (83839.59 447455)
6   484697814          &lt;NA&gt; POINT (83892.53 447475.5)
7   549139430        marina POINT (84479.99 446823.5)
8   603300994 sports_centre POINT (82485.72 445237.5)
9   883518959 sports_centre POINT (85385.25 448341.3)
10 1148515039    playground    POINT (84661.3 446818)</code></pre>
</div>
<p>We have our answer (<code>sports_centre</code> is the third value),
but in general this is not a good approach as the first rows might still
have many <code>NA</code>s and three distinct values might still not be
present in the first <code>n</code> rows of the data frame. To remove
<code>NA</code>s, we can use the function <code>na.omit()</code> on the
leisure column to remove <code>NA</code>s completely. Note that we use
the <code>$</code> operator to examine the content of a single
variable.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this is better</span></span>
<span><span class="fu">na.omit</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">head</span><span class="op">(</span><span class="op">)</span>  </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table"  "marina"        "marina"        "sports_centre"
[5] "sports_centre" "playground"   </code></pre>
</div>
<p>To show only unique values, we can use the <code>levels()</code>
function on a factor to only see the first occurrence of each distinct
value. Note <code>NA</code>s are dropped in this case and that we get
the first three of the unique alphabetically ordered values.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this is even better</span></span>
<span><span class="fu">factor</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">levels</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>   </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "dance"       "dog_park"    "escape_game"</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>To see a list of all fields names and answer the last question, we
can use the <code>names()</code> function.</li>
</ol>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "osm_id"   "leisure"  "geometry"</code></pre>
</div>
<ol style="list-style-type: upper-alpha">
<li>
<code>location</code> is not a field of the <code>point_Delft</code>
object.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="subset-features">Subset features<a class="anchor" aria-label="anchor" href="#subset-features"></a>
</h2>
<p>We can use the <code>filter()</code> function to select a subset of
features from a spatial object, just like with data frames. Let’s select
only <code>cycleways</code> from our street data.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleway_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span>   </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span></code></pre>
</div>
<p>Our subsetting operation reduces the number of features from 11244 to
1397.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 11244</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">cycleway_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1397</code></pre>
</div>
<p>This can be useful, for instance, to calculate the total length of
cycleways. For that, we first need to calculate the length of each
segment with <code>st_length()</code></p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleway_Delft</span> <span class="op">&lt;-</span> <span class="va">cycleway_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cycleway_Delft</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 81759.58 ymin: 441227.3 xmax: 87326.76 ymax: 449834.5
Projected CRS: Amersfoort / RD New
  total_length                       geometry
1 115550.1 [m] MULTILINESTRING ((86399.68 ...</code></pre>
</div>
<p>Now we can plot only the cycleways.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cycleway_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Slow mobility network in Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Cycleways"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/10-explore-and-plot-by-vector-layer-attributes-rendered-plot-cycleway-1.png" alt="Map of cycleways in Delft." class="figure mx-auto d-block"><figcaption>
Map of cycleways in Delft.
</figcaption></figure><div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<!-- 7 minutes -->
<p>Challenge: Now with motorways</p>
<ol style="list-style-type: decimal">
<li>Create a new object that only contains the motorways in Delft.</li>
<li>How many features does the new object have?</li>
<li>What is the total length of motorways?</li>
<li>Plot the motorways.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To create the new object, we first need to see which value of the
<code>highway</code> column holds motorways. There is a value called
<code>motorway</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"
 [5] "residential"    "unclassified"   "construction"   "secondary"
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"
[13] "track"          "motorway"       "path"           "pedestrian"
[17] "primary"        "bridleway"      "trunk"          "tertiary_link"
[21] "services"       "secondary_link" "trunk_link"     "primary_link"
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<p>We extract only the features with the value
<code>motorway</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">motorway_Delft</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"motorway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">motorway_Delft</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 48 features and 2 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 84501.66 ymin: 442458.2 xmax: 87401.87 ymax: 449205.9
Projected CRS: Amersfoort / RD New
First 10 features:
      osm_id  highway                       geometry
1    7531946 motorway LINESTRING (87395.68 442480...
2    7531976 motorway LINESTRING (87401.87 442467...
3   46212227 motorway LINESTRING (86103.56 446928...
4  120945066 motorway LINESTRING (85724.87 447473...
5  120945068 motorway LINESTRING (85710.31 447466...
6  126548650 motorway LINESTRING (86984.12 443630...
7  126548651 motorway LINESTRING (86714.75 444772...
8  126548653 motorway LINESTRING (86700.23 444769...
9  126548654 motorway LINESTRING (86716.35 444766...
10 126548655 motorway LINESTRING (84961.78 448566...</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>There are 48 features with the value <code>motorway</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">motorway_Delft</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 48</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>The total length of motorways is 14877.4361477941.</li>
</ol>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">motorway_Delft_length</span> <span class="op">&lt;-</span> <span class="va">motorway_Delft</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_length <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Plot the motorways.</li>
</ol>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">motorway_Delft</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fast mobility network"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Motorways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/10-explore-and-plot-by-vector-layer-attributes-rendered-plot-motorway-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="customize-plots">Customize plots<a class="anchor" aria-label="anchor" href="#customize-plots"></a>
</h2>
<p>Let’s say that we want to color different road types with different
colors and that we want to determine those colors.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "cycleway"       "footway"        "service"        "steps"
 [5] "residential"    "unclassified"   "construction"   "secondary"
 [9] "busway"         "living_street"  "motorway_link"  "tertiary"
[13] "track"          "motorway"       "path"           "pedestrian"
[17] "primary"        "bridleway"      "trunk"          "tertiary_link"
[21] "services"       "secondary_link" "trunk_link"     "primary_link"
[25] "platform"       "proposed"       NA              </code></pre>
</div>
<p>If we look at all the unique values of the highway field of our
street network we see more than 20 values. Let’s focus on a subset of
four values to illustrate the use of distinct colours. We filter the
roads that have one of the four given values <code>"motorway"</code>,
<code>"primary"</code>, <code>"secondary"</code>, and
<code>"cycleway"</code>. Note that we do this with the <code>%in%</code>
operator which is a more compact equivalent of a series of
<code>==</code> equality conditions joined by the <code>|</code> (or)
operator. We also make sure that the highway column is a factor
column.</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_types</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>, <span class="st">"cycleway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lines_Delft_selection</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">%in%</span> <span class="va">road_types</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>highway <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">highway</span>, levels <span class="op">=</span> <span class="va">road_types</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Next we define the four colours we want to use, one for each type of
road in our vector object. Note that in R you can use named colours like
<code>"blue"</code>, <code>"green"</code>, <code>"navy"</code>, and
<code>"purple"</code>. If you are using RStudio, you will see the named
colours previewed in line. A full list of named colours can be listed
with the <code>colors()</code> function.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"navy"</span>, <span class="st">"purple"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can use the defined colour palette in a ggplot.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mobility Network of Delft"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Main Roads &amp; Cycleways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/10-explore-and-plot-by-vector-layer-attributes-rendered-plot-highway-types-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-adjust-line-width" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-adjust-line-width" class="callout-inner">
<h3 class="callout-title">Challenge: Adjust line width</h3>
<div class="callout-content">
<p>Follow the same steps to add custom line widths for every road
type.</p>
<ol style="list-style-type: decimal">
<li><p>Assign the custom values <code>1</code>, <code>0.75</code>,
<code>0.5</code>, <code>0.25</code> in this order to an object called
<code>line_widths</code>. These values will represent line thicknesses
that are consistent with the hierarchy of the selected road
types.</p></li>
<li><p>In this case the <code>linewidth</code> argument, like the
<code>color</code> argument above, should be within the
<code>aes()</code> mapping function and should take the values of the
custom line widths.</p></li>
<li><p>Plot the result, making sure that <code>linewidth</code> is named
the same way as <code>color</code> in the legend.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_widths</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span>, linewidth <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_widths</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>,</span>
<span>       linewidth <span class="op">=</span> <span class="st">"Road Type"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mobility Network of Delft"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Main Roads &amp; Cycleways"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/10-explore-and-plot-by-vector-layer-attributes-rendered-plot-highway-types2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenge-plot-lines-by-attributes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-lines-by-attributes" class="callout-inner">
<h3 class="callout-title">Challenge: Plot lines by attributes</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a plot that emphasizes only roads where bicycles are allowed.
To emphasize this, make the lines where bicycles are not allowed THINNER
than the roads where bicycles are allowed. Be sure to add a title and
legend to your map. You might consider a color palette that has all
bike-friendly roads displayed in a bright color. All other lines can be
black.</p>
<p>Tip: <code>geom_sf()</code> can be called multiple times for
multi-layer maps.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">lines_Delft_selection</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "factor"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="fu">factor</span><span class="op">(</span><span class="va">lines_Delft</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "bridleway"      "busway"         "construction"   "cycleway"
 [5] "footway"        "living_street"  "motorway"       "motorway_link"
 [9] "path"           "pedestrian"     "platform"       "primary"
[13] "primary_link"   "proposed"       "residential"    "secondary"
[17] "secondary_link" "service"        "services"       "steps"
[21] "tertiary"       "tertiary_link"  "track"          "trunk"
[25] "trunk_link"     "unclassified"  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, create a data frame with only roads where bicycles </span></span>
<span><span class="co"># are allowed</span></span>
<span><span class="va">lines_Delft_bicycle</span> <span class="op">&lt;-</span> <span class="va">lines_Delft</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Next, visualise it using ggplot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">lines_Delft_bicycle</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="st">"magenta"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Mobility network in Delft"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Roads dedicated to Bikes"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/10-explore-and-plot-by-vector-layer-attributes-rendered-plot-cycleways2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li><p>Spatial objects in <code>sf</code> are similar to standard data
frames and can be manipulated using the same functions.</p></li>
<li><p>Almost any feature of a plot can be customized using the various
functions and options in the <code>ggplot2</code> package.</p></li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section><section id="aio-11-plot-multiple-shape-files"><p>Content from <a href="11-plot-multiple-shape-files.html">Plot multiple shapefiles</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/11-plot-multiple-shape-files.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create map compositions with custom legends using
ggplot?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Plot multiple vector layers in the same plot.</li>
<li>Apply custom symbols to spatial objects in a plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode builds upon the <a href="10-explore-and-plot-by-vector-layer-attributes.html">previous
episode</a> to work with vector layers in R and explore how to plot
multiple vector layers.</p>
<section><h2 class="section-heading" id="load-the-data">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>To work with vector data in R, we use the <code>sf</code> package.
Make sure that it is loaded.</p>
<p>We will continue to work with the three shapefiles that we loaded in
the <a href="09-open-and-plot-vector-layers.html">Open and Plot Vector
Layers</a> episode.</p>
</section><section><h2 class="section-heading" id="plotting-multiple-vector-layers">Plotting Multiple Vector Layers<a class="anchor" aria-label="anchor" href="#plotting-multiple-vector-layers"></a>
</h2>
<hr class="half-width">
<p>So far we learned how to plot information from a single shapefile and
do some plot customization. What if we want to create a more complex
plot with many shapefiles and unique symbols that need to be represented
clearly in a legend?</p>
<p>We will create a plot that combines our leisure locations
(<code>point_Delft</code>), municipal boundary
(<code>boundary_Delft</code>) and street (<code>lines_Delft</code>)
objects. We will also build a custom legend.</p>
<p>To begin, we create a plot with the site boundary as the first layer.
Then layer the leisure locations and street data on top in consecutive
calls to <code>geom_sf()</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, </span>
<span>          fill <span class="op">=</span> <span class="st">"lightgrey"</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"lightgrey"</span></span>
<span>          <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, </span>
<span>          <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>, </span>
<span>          size <span class="op">=</span> <span class="fl">1</span></span>
<span>          <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_Delft</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network of Delft"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/11-plot-multiple-shape-files-rendered-plot-multiple-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Next, let’s build a custom legend using the functions
<code>scale_color_manual()</code> and <code>scale_fill_manual()</code>.
We will use the custom <code>road_colors</code> object created in the
previous episode and we will create a new object called
<code>leisure_colors</code> to store values of all 15 types of leisure
with the <code>rainbow()</code> function.</p>
<p>We also need to customise the shape of the points with the
<code>shape</code> aesthetic if we want to determine the colours inside
the points. <code>shape = 21</code> will show the points as circles with
a custom fill.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">point_Delft</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">length</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leisure_colors</span> <span class="op">&lt;-</span> <span class="fu">rainbow</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">boundary_Delft</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"lightgrey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">lines_Delft_selection</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">point_Delft</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">21</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">road_colors</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Road Type"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">leisure_colors</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Lesiure Location"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network and leisure in Delft"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/11-plot-multiple-shape-files-rendered-plot-multiple2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-customizing-point-shapes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-customizing-point-shapes" class="callout-inner">
<h3 class="callout-title">Challenge: Customizing point shapes</h3>
<div class="callout-content">
<p>What value of <code>shape</code> will display points as squares with
custom fills?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><code>shape = 22</code> will display points as squares with custom
fills. Our previous plot would look like this:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">boundary_Delft</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"lightgrey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">lines_Delft_selection</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">point_Delft</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">22</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">road_colors</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Line Type"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">leisure_colors</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Leisure Location"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mobility network and leisure in Delft"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/11-plot-multiple-shape-files-rendered-plot-multiple3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>We notice that there are quite some playgrounds in the residential
parts of Delft, whereas on campus there is a concentration of picnic
tables. So that is what our next challenge is about.</p>
<div id="challenge-visualising-multiple-layers-with-a-custom-legend" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-visualising-multiple-layers-with-a-custom-legend" class="callout-inner">
<h3 class="callout-title">Challenge: Visualising multiple layers with a custom legend</h3>
<div class="callout-content">
<p>Create a map of leisure locations only including
<code>playground</code> and <code>picnic_table</code>, with each point
coloured by the leisure type. Overlay this layer on top of the
<code>lines_Delft</code> layer (the streets). Tell R to plot playgrounds
and picnic tables with different <code>shape</code> values. Make sure
your plot has a custom legend.</p>
<p>Tip: You can call <code>scale_</code> functions multiple times for
the same layer, for any of the aesthetics used in
<code>aes()</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leisure_locations_selection</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-leisure.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">leisure</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"playground"</span>, <span class="st">"picnic_table"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-leisure' from data source
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-leisure.shp'
  using driver `ESRI Shapefile'
Simple feature collection with 298 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 81863.21 ymin: 442621.1 xmax: 87370.15 ymax: 449345.1
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">factor</span><span class="op">(</span><span class="va">leisure_locations_selection</span><span class="op">$</span><span class="va">leisure</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">levels</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "picnic_table" "playground"  </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blue_orange</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="st">"darkorange"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_Delft_selection</span>, </span>
<span>          <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highway</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">leisure_locations_selection</span>, </span>
<span>          <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">leisure</span>, shape <span class="op">=</span> <span class="va">leisure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Leisure Type"</span>, </span>
<span>                     values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Type"</span>, </span>
<span>                     values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Leisure Type"</span>, </span>
<span>                    values <span class="op">=</span> <span class="va">blue_orange</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Road network and leisure"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/11-plot-multiple-shape-files-rendered-plot-leisure-locations-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A plot can be a combination of multiple vector layers, each added
with a separate call to <code>geom_sf()</code>.</li>
<li>Use the <code>scale_&lt;aesthetic&gt;_manual()</code> functions to
customise aesthetics of vector layers such as <code>color</code>,
<code>fill</code>, and <code>shape</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-12-handling-spatial-projection-and-crs"><p>Content from <a href="12-handling-spatial-projection-and-crs.html">Handling Spatial Projections &amp; CRS</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/12-handling-spatial-projection-and-crs.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What do I do when vector data do not line up?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Plot vector objects with different CRSs in the same plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="working-with-spatial-data-from-different-sources">Working with spatial data from different sources<a class="anchor" aria-label="anchor" href="#working-with-spatial-data-from-different-sources"></a>
</h2>
<hr class="half-width">
<p>In this episode, we will work with a different dataset containing
Dutch municipal boundaries. We start by reading the data and plotting
it.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">municipal_boundary_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-gemeenten.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-gemeenten' from data source
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-gemeenten.shp'
  using driver `ESRI Shapefile'
Simple feature collection with 344 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-handling-spatial-projection-and-crs-rendered-plot-minicipal-boundary-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can add a country boundary layer to make it look nicer. If we
specify a thicker line width using size = 2 for the country boundary
layer, it will make our map pop! We read the country boundary from a
different file.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_boundary_NL</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/nl-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `nl-boundary' from data source
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/nl-boundary.shp'
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 10425.16 ymin: 306846.2 xmax: 278026.1 ymax: 621876.3
Projected CRS: Amersfoort / RD New</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_NL</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"gray18"</span>, </span>
<span>          linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-handling-spatial-projection-and-crs-rendered-plot-boundaries-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We confirm that the CRS of both boundaries is 28992.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">municipal_boundary_NL</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">country_boundary_NL</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28992</code></pre>
</div>
<p>We read the municipal boundary of Delft and make sure that it is in
the same CRS as the country-level municipal boundaries and country
boundary layers.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/delft-boundary.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `delft-boundary' from data source
  `/home/runner/work/r-geospatial-urban/r-geospatial-urban/site/built/data/delft-boundary.shp'
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 4.320218 ymin: 51.96632 xmax: 4.407911 ymax: 52.0326
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">boundary_Delft</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4326</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_Delft</span> <span class="op">&lt;-</span> <span class="fu">st_transform</span><span class="op">(</span><span class="va">boundary_Delft</span>, <span class="fl">28992</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_NL</span>, </span>
<span>          linewidth <span class="op">=</span> <span class="fl">2</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">municipal_boundary_NL</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"purple"</span>, </span>
<span>          fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous NL Municipal Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-handling-spatial-projection-and-crs-rendered-plot-boundaries2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-plot-multiple-layers-of-spatial-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-multiple-layers-of-spatial-data" class="callout-inner">
<h3 class="callout-title">Challenge: Plot multiple layers of spatial data</h3>
<div class="callout-content">
<!-- 5 minutes -->
<p>Create a map of South Holland as follows:</p>
<ol style="list-style-type: decimal">
<li>Import <code>nl-gemeenten.shp</code> and filter only the
municipalities in South Holland.</li>
<li>Plot it and adjust line width as necessary.</li>
<li>Layer the boundary of Delft onto the plot.</li>
<li>Add a title.</li>
<li>Add a legend that shows both the municipal boundaries (as a line)
and the boundary of Delft (as a filled polygon).</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundary_ZH</span> <span class="op">&lt;-</span> <span class="va">municipal_boundary_NL</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">ligtInPr_1</span> <span class="op">==</span> <span class="st">"Zuid-Holland"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_ZH</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span><span class="st">"color"</span><span class="op">)</span>, </span>
<span>            show.legend <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, </span>
<span>                       labels <span class="op">=</span> <span class="st">"Municipal Boundaries in South Holland"</span>, </span>
<span>                       values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"color"</span> <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary_Delft</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"shape"</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"purple"</span>, </span>
<span>            fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_shape_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, </span>
<span>                       labels <span class="op">=</span> <span class="st">"Municipality of Delft"</span>, </span>
<span>                       values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"shape"</span> <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span>                       <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Delft location"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-handling-spatial-projection-and-crs-rendered-plot-boundary-zh-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="projecting-layers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="projecting-layers" class="callout-inner">
<h3 class="callout-title">Projecting layers</h3>
<div class="callout-content">
<p>Note that <code>ggplot2</code> may reproject the layers on the fly
for visualisation purposes, but for geoprocessing purposes, you still
need to reproject the layers explicitly with
<code>st_transform()</code>. This will become clear in a <a href="19-basic-gis-with-r-sf.html">later episode</a> when we perform GIS
operations.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="export-a-shapefile">Export a shapefile<a class="anchor" aria-label="anchor" href="#export-a-shapefile"></a>
</h2>
<hr class="half-width">
<p>To save a file, use the <code>st_write()</code> function from the
<code>sf</code> package. Although <code>sf</code> guesses the driver
needed for a specified output file name from its extension, this can be
made explicitly via the <code>driver</code> argument. In our case
<code>driver = "ESRI Shapefile"</code> ensures that the output is
correctly saved as a <code>.shp</code> file.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_write</span><span class="op">(</span><span class="va">leisure_locations_selection</span>,</span>
<span>  <span class="st">"data/leisure_locations_selection.shp"</span>,</span>
<span>  driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<code>ggplot2</code> automatically converts all objects in a plot to
the same CRS.</li>
<li>For geoprocessing purposes, you still need to reproject the layers
you use to the same CRS.</li>
<li>You can export an <code>sf</code> object to a shapefile with
<code>st_write()</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-13-intro-to-raster-data"><p>Content from <a href="13-intro-to-raster-data.html">Intro to Raster Data</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/13-intro-to-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 32 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a raster dataset?</li>
<li>How do I import, examine and plot raster data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Import rasters into R using the <code>terra</code> package.</li>
<li>Explore raster attributes and metadata using the <code>terra</code>
package.</li>
<li>Plot a raster file in R using the <code>ggplot2</code> package.</li>
<li>Describe the difference between single- and multi-band rasters.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this episode</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<p>This lesson uses the <code>terra</code> package in particular. If you
have not installed it yet, do so by running
<code>install.packages("terra")</code> before loading it with
<code><a href="https://rspatial.org/" class="external-link">library(terra)</a></code>.</p>
</div>
</div>
</div>
<p>In this lesson, we will work with raster data. We will start with an
introduction of the fundamental principles and metadata needed to work
with raster data in R. We will discuss some of the core metadata
elements needed to understand raster data in R, including CRS and
resolution.</p>
<p>We continue to work with the <code>tidyverse</code> package and we
will use the <code>terra</code> package to work with raster data. Make
sure that you have those packages loaded.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-data-used-in-this-lesson" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-data-used-in-this-lesson" class="callout-inner">
<h3 class="callout-title">The data used in this lesson</h3>
<div class="callout-content">
<p>In this and lesson, we will use:</p>
<ul>
<li>data extracted from the <a href="https://www.ahn.nl/" class="external-link">AHN digital
elevation dataset of the Netherlands</a> for the TU Delft campus area;
and</li>
<li>high-resolution RGB aerial photos of the TU Delft library obtained
from <a href="https://www.beeldmateriaal.nl/download-luchtfotos" class="external-link">Beeldmateriaal
Nederland</a>.</li>
</ul>
</div>
</div>
</div>
<section><h2 class="section-heading" id="view-raster-file-attributes">View Raster File Attributes<a class="anchor" aria-label="anchor" href="#view-raster-file-attributes"></a>
</h2>
<hr class="half-width">
<p>We will be working with a series of GeoTIFF files in this lesson. The
GeoTIFF format contains a set of embedded tags with metadata about the
raster data. We can use the function <code>describe()</code> from the
<code>terra</code> package to get information about our raster. It is
recommended to do this before importing the data. We first examine the
file <code>tud-dsm-5m.tif</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"
 [2] "Files: data/tud-dsm-5m.tif"
 [3] "Size is 722, 386"
 [4] "Coordinate System is:"
 [5] "PROJCRS[\"Amersfoort / RD New\","
 [6] "    BASEGEOGCRS[\"Amersfoort\","
 [7] "        DATUM[\"Amersfoort\","
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"
 [9] "                LENGTHUNIT[\"metre\",1]]],"
[10] "        PRIMEM[\"Greenwich\",0,"
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[12] "        ID[\"EPSG\",4289]],"
[13] "    CONVERSION[\"RD New\","
[14] "        METHOD[\"Oblique Stereographic\","
[15] "            ID[\"EPSG\",9809]],"
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[18] "            ID[\"EPSG\",8801]],"
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[21] "            ID[\"EPSG\",8802]],"
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"
[23] "            SCALEUNIT[\"unity\",1],"
[24] "            ID[\"EPSG\",8805]],"
[25] "        PARAMETER[\"False easting\",155000,"
[26] "            LENGTHUNIT[\"metre\",1],"
[27] "            ID[\"EPSG\",8806]],"
[28] "        PARAMETER[\"False northing\",463000,"
[29] "            LENGTHUNIT[\"metre\",1],"
[30] "            ID[\"EPSG\",8807]]],"
[31] "    CS[Cartesian,2],"
[32] "        AXIS[\"easting (X)\",east,"
[33] "            ORDER[1],"
[34] "            LENGTHUNIT[\"metre\",1]],"
[35] "        AXIS[\"northing (Y)\",north,"
[36] "            ORDER[2],"
[37] "            LENGTHUNIT[\"metre\",1]],"
[38] "    USAGE["
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"
[42] "    ID[\"EPSG\",28992]]"
[43] "Data axis to CRS axis mapping: 1,2"
[44] "Origin = (83565.000000000000000,447180.000000000000000)"
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"
[46] "Metadata:"
[47] "  AREA_OR_POINT=Area"
[48] "Image Structure Metadata:"
[49] "  INTERLEAVE=BAND"
[50] "Corner Coordinates:"
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<p>We will be using this information throughout this episode. By the end
of the episode, you will be able to explain and understand the output
above.</p>
</section><section><h2 class="section-heading" id="open-a-raster-in-r">Open a Raster in R<a class="anchor" aria-label="anchor" href="#open-a-raster-in-r"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve previewed the metadata for our GeoTIFF, let’s import
this raster file into R and explore its metadata more closely. We can
use the <code>rast()</code> function to import a raster file in R.</p>
<div id="data-tip---object-names" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---object-names" class="callout-inner">
<h3 class="callout-title">Data tip - Object names</h3>
<div class="callout-content">
<p>To improve code readability, use file and object names that make it
clear what is in the file. The raster data for this episode contain the
TU Delft campus and its surroundings so we will use the naming
convention <code>&lt;DATATYPE&gt;_TUD</code>. The first object is a
Digital Surface Model (DSM) in GeoTIFF format stored in a file
<code>tud-dsm-5m.tif</code> which we will load into an object named
according to our naming convention <code>DSM_TUD</code>.</p>
</div>
</div>
</div>
<p>Let’s load our raster file into R and view its data structure.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span>
<span><span class="va">DSM_TUD</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster
dimensions  : 386, 722, 1  (nrow, ncol, nlyr)
resolution  : 5, 5  (x, y)
extent      : 83565, 87175, 445250, 447180  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992)
source      : tud-dsm-5m.tif
name        : tud-dsm-5m </code></pre>
</div>
<p>The information above includes a report on dimension, resolution,
extent and CRS, but no information about the values. Similar to other
data structures in R like vectors and data frames, descriptive
statistics for raster data can be retrieved with the
<code>summary()</code> function.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: [summary] used a sample</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   tud.dsm.5m
 Min.   :-5.2235
 1st Qu.:-0.7007
 Median : 0.5462
 Mean   : 2.5850
 3rd Qu.: 4.4596
 Max.   :89.7838  </code></pre>
</div>
<p>This output gives us information about the range of values in the
DSM. We can see, for instance, that the lowest elevation is
<code>-5.2235</code>, the highest is <code>89.7838</code>. But note the
warning. Unless you force R to calculate these statistics using every
cell in the raster, it will take a random sample of 100,000 cells and
calculate from them instead. To force calculation all the values, you
can use the function <code>values</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   tud-dsm-5m
 Min.   :-5.3907
 1st Qu.:-0.7008
 Median : 0.5573
 Mean   : 2.5886
 3rd Qu.: 4.4648
 Max.   :92.0810  </code></pre>
</div>
<p>With a summary on all cells of the raster, the values range from a
smaller minimum of <code>-5.3907</code> to a higher maximum of
<code>92.0910</code>.</p>
<p>To visualise the DSM in R using <code>ggplot2</code>, we need to
convert it to a data frame. We learned about data frames in an <a href="03-explore-data.html">earlier lesson</a>. The <code>terra</code>
package has the built-in method <code>as.data.frame()</code> for
conversion to a data frame.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now when we view the structure of our data, we will see a standard
data frame format in which every row is a cell from the raster, each
containing information about the <code>x</code> and <code>y</code>
coordinates and the raster value stored in the <code>tud-dsm-5m</code>
column.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	278692 obs. of  3 variables:
 $ x         : num  83568 83572 83578 83582 83588 ...
 $ y         : num  447178 447178 447178 447178 447178 ...
 $ tud-dsm-5m: num  10.34 8.64 1.25 1.12 2.13 ...</code></pre>
</div>
<p>We can use <code>ggplot()</code> to plot this data with a specific
<code>geom_</code> function called <code>geom_raster()</code>. We will
make the colour scale in our plot colour-blindness friendly with
<code>scale_fill_viridis_c</code>, introduced in an <a href="04-intro-to-visualisation.html">earlier lesson</a>. We will also
use the <code>coord_equal()</code> function to ensure that the units
(meters in our case) on the two axes are equal.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/13-intro-to-raster-data-rendered-first-rast-plot-1.png" alt="Raster plot with `ggplot2` using the viridis color scale" class="figure mx-auto d-block"><figcaption>
Raster plot with <code>ggplot2</code> using the viridis color scale
</figcaption></figure><div id="plotting-tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip" class="callout-inner">
<h3 class="callout-title">Plotting tip</h3>
<div class="callout-content">
<p>The <code>"turbo"</code> scale in our code provides a good
contrasting scale for our raster, but another colour scale may be
preferred when plotting other rasters. More information about the
viridis palette used above can be found in the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html" class="external-link">viridis
package documentation</a>.</p>
</div>
</div>
</div>
<div id="plotting-tip-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip-1" class="callout-inner">
<h3 class="callout-title">Plotting tip</h3>
<div class="callout-content">
<p>For faster previews, you can use the <code>plot()</code> function on
a <code>terra</code> object.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="view-raster-coordinate-reference-system-crs">View Raster Coordinate Reference System (CRS)<a class="anchor" aria-label="anchor" href="#view-raster-coordinate-reference-system-crs"></a>
</h2>
<hr class="half-width">
<p>The map above shows our Digital Surface Model (DSM), that is, the
elevation of our study site including buildings and vegetation. From the
legend we can confirm that the maximum elevation is around 90, but we
cannot tell whether that is 90 feet or 90 meters because the legend does
not show us the units. We can look at the metadata of our object to see
what the units are. Much of the metadata that we are interested in is
part of the CRS.</p>
<p>Now we will see how features of the CRS appear in our data file and
what meaning they have.</p>
<p>We can view the CRS string associated with our R object using the
<code>crs()</code> function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DSM_TUD</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=sterea +lat_0=52.1561605555556 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs"</code></pre>
</div>
<div id="challenge-what-units-are-our-data-in" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-what-units-are-our-data-in" class="callout-inner">
<h3 class="callout-title">Challenge: What units are our data in?</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>+units=m</code> in the output of the code above tells us that
our data is in meters (m).</p>
</div>
</div>
</div>
</div>
<div id="understanding-crs-in-proj.4-format" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="understanding-crs-in-proj.4-format" class="callout-inner">
<h3 class="callout-title">Understanding CRS in PROJ.4 format</h3>
<div class="callout-content">
<p>The CRS for our data is given to us by R in PROJ.4 format. Let’s
break down the pieces of a PROJ.4 string. The string contains all of the
individual CRS elements that R or another GIS might need. Each element
is specified with a <code>+</code> sign, similar to how a
<code>.csv</code> file is delimited or broken up by a <code>,</code>.
After each <code>+</code> we see the CRS element such as projection
(<code>proj=</code>) being defined.</p>
<p>See more about CRS and PROJ.4 strings in <a href="https://datacarpentry.org/organization-geospatial/03-crs#describing-coordinate-reference-systems" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="calculate-raster-min-and-max-values">Calculate Raster Min and Max values<a class="anchor" aria-label="anchor" href="#calculate-raster-min-and-max-values"></a>
</h2>
<hr class="half-width">
<p>It is useful to know the minimum and maximum values of a raster
dataset. In this case, as we are working with elevation data, these
values represent the minimum-to-maximum elevation range at our site.</p>
<p>Raster statistics are often calculated and embedded in a GeoTIFF for
us. We can view these values:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">minmax</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    tud-dsm-5m
min        Inf
max       -Inf</code></pre>
</div>
<div id="data-tip---set-min-and-max-values" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---set-min-and-max-values" class="callout-inner">
<h3 class="callout-title">Data tip - Set min and max values</h3>
<div class="callout-content">
<p>If the <code>min</code> and <code>max</code> values are
<code>Inf</code> and <code>-Inf</code> respectively, it means that they
haven’t been calculated. We can calculate them using the
<code>setMinMax()</code> function.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD</span> <span class="op">&lt;-</span> <span class="fu">setMinMax</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>A call to <code>minmax(DSM_TUD)</code> will now give us the correct
values. Alternatively, <code>min(values())</code> and
<code>max(values())</code> will return the minimum and maximum values
respectively.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -5.39069</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 92.08102</code></pre>
</div>
<p>We can see that the elevation at our site ranges from
<code>-5.39069</code>m to <code>92.08102</code>m.</p>
</section><section><h2 class="section-heading" id="raster-bands">Raster bands<a class="anchor" aria-label="anchor" href="#raster-bands"></a>
</h2>
<hr class="half-width">
<p>The Digital Surface Model object (<code>DSM_TUD</code>) that we have
been working with is a single band raster. This means that there is only
one layer stored in the raster: surface elevation in meters for one time
period.</p>
<p>We can view the number of bands in a raster using the
<code>nlyr()</code> function.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlyr</span><span class="op">(</span><span class="va">DSM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<figure><img src="https://datacarpentry.org/r-raster-vector-geospatial/fig/dc-spatial-raster/single_multi_raster.png" alt="Single- and multi-band raster" class="figure mx-auto d-block"><div class="figcaption">Single- and multi-band raster</div>
</figure><p>Our DSM data has only one band. However, raster data can also be
multi-band, meaning that one raster file contains data for more than one
variable or time period for each cell. We will discuss multi-band raster
data in a <a href="17-work-with-multi-band-rasters.html">later
episode</a>.</p>
</section><section><h2 class="section-heading" id="creating-a-histogram-of-raster-values">Creating a histogram of raster values<a class="anchor" aria-label="anchor" href="#creating-a-histogram-of-raster-values"></a>
</h2>
<hr class="half-width">
<p>A histogram can be used to inspect the distribution of raster values
visually. It can show if there are values above the maximum or below the
minimum of the expected range. We can plot a histogram using the
<code>ggplot2</code> function <code>geom_histogram()</code>. Histograms
are often useful in identifying outliers and bad data values in our
raster data. Read more on the use of histograms in <a href="https://datacarpentry.org/r-raster-vector-geospatial/01-raster-structure.html#create-a-histogram-of-raster-values" class="external-link">this
lesson</a></p>
<div id="challenge-explore-raster-metadata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-explore-raster-metadata" class="callout-inner">
<h3 class="callout-title">Challenge: Explore raster metadata</h3>
<div class="callout-content">
<p>Use <code>describe()</code> to determine the following about the
<code>tud-dsm-hill.tif</code> file:</p>
<ol style="list-style-type: decimal">
<li>Does this file have the same CRS as <code>DSM_TUD</code>?</li>
<li>What is the resolution of the raster data?</li>
<li>How large would a 5x5 pixel area be on the Earth’s surface?</li>
<li>Is the file a multi- or single-band raster?</li>
</ol>
<p>Note that this file is a hillshade raster. We will learn about
hillshades in the <a href="17-work-with-multi-band-rasters.html">Working
with Multi-band Rasters in R</a> episode.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m-hill.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"
 [2] "Files: data/tud-dsm-5m-hill.tif"
 [3] "Size is 722, 386"
 [4] "Coordinate System is:"
 [5] "PROJCRS[\"Amersfoort / RD New\","
 [6] "    BASEGEOGCRS[\"Amersfoort\","
 [7] "        DATUM[\"Amersfoort\","
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"
 [9] "                LENGTHUNIT[\"metre\",1]]],"
[10] "        PRIMEM[\"Greenwich\",0,"
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[12] "        ID[\"EPSG\",4289]],"
[13] "    CONVERSION[\"RD New\","
[14] "        METHOD[\"Oblique Stereographic\","
[15] "            ID[\"EPSG\",9809]],"
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[18] "            ID[\"EPSG\",8801]],"
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[21] "            ID[\"EPSG\",8802]],"
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"
[23] "            SCALEUNIT[\"unity\",1],"
[24] "            ID[\"EPSG\",8805]],"
[25] "        PARAMETER[\"False easting\",155000,"
[26] "            LENGTHUNIT[\"metre\",1],"
[27] "            ID[\"EPSG\",8806]],"
[28] "        PARAMETER[\"False northing\",463000,"
[29] "            LENGTHUNIT[\"metre\",1],"
[30] "            ID[\"EPSG\",8807]]],"
[31] "    CS[Cartesian,2],"
[32] "        AXIS[\"easting (X)\",east,"
[33] "            ORDER[1],"
[34] "            LENGTHUNIT[\"metre\",1]],"
[35] "        AXIS[\"northing (Y)\",north,"
[36] "            ORDER[2],"
[37] "            LENGTHUNIT[\"metre\",1]],"
[38] "    USAGE["
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"
[42] "    ID[\"EPSG\",28992]]"
[43] "Data axis to CRS axis mapping: 1,2"
[44] "Origin = (83565.000000000000000,447180.000000000000000)"
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"
[46] "Metadata:"
[47] "  AREA_OR_POINT=Area"
[48] "Image Structure Metadata:"
[49] "  INTERLEAVE=BAND"
[50] "Corner Coordinates:"
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"
[56] "Band 1 Block=722x11 Type=Byte, ColorInterp=Gray"
[57] "  NoData Value=0"                                                                                                      </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="more-resources" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-resources" class="callout-inner">
<h3 class="callout-title">More resources</h3>
<div class="callout-content">
<ul>
<li>See the manual and tutorials of the <code>terra</code> package on <a href="https://rspatial.org/" class="external-link">https://rspatial.org/</a>.</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The GeoTIFF file format includes metadata about the raster data that
can be inspected with the <code>describe()</code> function from the
<code>terra</code> package.</li>
<li>To plot raster data with the <code>ggplot2</code> package, we need
to convert them to data frames.</li>
<li>PROJ is a widely used standard format to store, represent and
transform CRS.</li>
<li>Histograms are useful to identify missing or bad data values.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-14-plot-raster-data"><p>Content from <a href="14-plot-raster-data.html">Plot Raster Data</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/14-plot-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create categorized maps of raster data?</li>
<li>How can I customize the colour scheme of a raster image?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Build customized plots for a single band raster using the
<code>ggplot2</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this episode</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<p>This lesson uses the <code>terra</code> package in particular. If you
have not installed it yet, do so by running
<code>install.packages("terra")</code> before loading it with
<code><a href="https://rspatial.org/" class="external-link">library(terra)</a></code>.</p>
</div>
</div>
</div>
<p>In this part, we will plot our raster object using
<code>ggplot2</code> with customized colour schemes. We will continue
working with the Digital Surface Model (DSM) raster from the <a href="13-intro-to-raster-data.html">previous episode</a>.</p>
<section><h2 class="section-heading" id="plotting-data-using-breaks">Plotting Data Using Breaks<a class="anchor" aria-label="anchor" href="#plotting-data-using-breaks"></a>
</h2>
<hr class="half-width">
<p>In the previous plot, our DSM was coloured with a continuous colour
range. For clarity and visibility, we may prefer to view the data
“symbolized” or coloured according to ranges of values. This is
comparable to a “classified” map. For that, we need to tell
<code>ggplot()</code> how many groups to break our data into and where
those breaks should be. To make these decisions, it is useful to first
explore the distribution of the data using a bar plot. To begin with, we
will use <code>dplyr</code>’s <code>mutate()</code> function combined
with <code>cut()</code> to split the data into 3 bins.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/14-plot-raster-data-rendered-dsm-fct-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To see the cut-off values for the groups, we can ask for the levels
of <code>fct_elevation</code>:
<code>{rdsm-fct-levels} levels(DSM_TUD_df$fct_elevation)</code></p>
<p>And we can get the count of values (that is, number of pixels) in
each group using <code>dplyr</code>’s <code>count()</code> function:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  fct_elevation      n
1  (-5.49,27.1] 277100
2   (27.1,59.6]   1469
3   (59.6,92.2]    123</code></pre>
</div>
<p>We might prefer to customize the cut-off values for these groups.
Lets round the cut-off values so that we have groups for the ranges of
-10-0 m, 0-5 m, and 5-100 m. To implement this we will give
<code>cut()</code> a numeric vector of break points instead of the
number of breaks we want.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_cb <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation_cb</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-10,0]" "(0,5]"   "(5,100]"</code></pre>
</div>
<div id="data-tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data tip</h3>
<div class="callout-content">
<p>Note that 4 break values will result in 3 bins of data.</p>
<p>The bin intervals are shown using <code>(</code> to mean exclusive
and <code>]</code> to mean inclusive. For example: (0, 5] means “from 0
through 5”.</p>
</div>
</div>
</div>
<p>And now we can plot our bar plot again, using the new groups:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/14-plot-raster-data-rendered-plot-dsm-fct-cb-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And we can get the count of values in each group in the same way we
did before:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">fct_elevation_cb</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  fct_elevation_cb      n
1          (-10,0] 113877
2            (0,5] 101446
3          (5,100]  63369</code></pre>
</div>
<p>We can use those groups to plot our raster data, with each group
being a different colour:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/14-plot-raster-data-rendered-plot-dsm-fct-cb2-1.png" style="display: block; margin: auto;" class="figure">
The plot above uses the default colours inside <code>ggplot2</code> for
raster objects. We can specify our own colours to make the plot look a
little nicer. R has a built in set of colours for plotting terrain
available through the <code>terrain.colors()</code> function. Since we
have three bins, we want to create a 3-colour palette:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "#00A600" "#ECB176" "#F2F2F2"</code></pre>
</div>
<p>The <code>terrain.colors()</code> function returns hex colours - each
of these character strings represents a colour. To use these in our map,
we pass them to the <code>values</code> argument in the
<code>scale_fill_manual()</code> function.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/14-plot-raster-data-rendered-plot-dsm-fct-cb3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="more-plot-formatting">More Plot Formatting<a class="anchor" aria-label="anchor" href="#more-plot-formatting"></a>
</h2>
<hr class="half-width">
<p>If we need to create multiple plots using the same colour palette, we
can create an R object (<code>my_col</code>) for the set of colours that
we want to use. We can then quickly change the palette across all plots
by modifying the <code>my_col</code> object, rather than each individual
plot.</p>
<p>We can give the legend a more meaningful title with the
<code>name</code> argument of the <code>scale_fill_manual()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/14-plot-raster-data-rendered-plot-dsm-fct-cb4-1.png" style="display: block; margin: auto;" class="figure">
The axis labels x and y are not necessary, so we can turn them off by
passing <code>element_blank()</code> to the <code>axis.title</code>
argument in the <code>theme()</code> function.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="va">fct_elevation_cb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/14-plot-raster-data-rendered-plot-dsm-fct-cb5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-plot-using-custom-breaks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-plot-using-custom-breaks" class="callout-inner">
<h3 class="callout-title">Challenge: Plot Using Custom Breaks</h3>
<div class="callout-content">
<p>Create a plot of the TU Delft Digital Surface Model
(<code>DSM_TUD</code>) that has:</p>
<ol style="list-style-type: decimal">
<li>Six classified ranges of values (break points) that are evenly
divided among the range of pixel values.</li>
<li>A plot title.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_6 <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">DSM_TUD_df</span><span class="op">$</span><span class="va">fct_elevation_6</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "(-5.49,10.9]" "(10.9,27.1]"  "(27.1,43.3]"  "(43.3,59.6]"  "(59.6,75.8]"
[6] "(75.8,92.2]" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       fill <span class="op">=</span> <span class="va">fct_elevation_6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span>, name <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Elevation Classes of the Digital Surface Model (DSM)"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/14-plot-raster-data-rendered-plot-dsm-fct-cb6-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Continuous data ranges can be grouped into categories using
<code>mutate()</code> and <code>cut()</code>.</li>
<li>Use the built-in <code>terrain.colors()</code> or set your preferred
colour scheme manually.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-15-reproject-raster-data"><p>Content from <a href="15-reproject-raster-data.html">Reproject Raster Data</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/15-reproject-raster-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 32 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I work with raster data sets that are in different
projections?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Reproject a raster in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this episode</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>Sometimes we encounter raster datasets that do not “line up” when
plotted or analysed. Rasters that do not line up are most often in
different Coordinate Reference Systems (CRS). This episode explains how
to deal with rasters in different CRS. It will walk through reprojecting
rasters in R using the <code>project()</code> function in the
<code>terra</code> package.</p>
<section><h2 class="section-heading" id="raster-projection">Raster Projection<a class="anchor" aria-label="anchor" href="#raster-projection"></a>
</h2>
<hr class="half-width">
<p>For this episode, we will be working with Digital Terrain Model data.
This differs from the surface model data we have been working with so
far in that the digital surface model (DSM) includes the tops of trees
and buildings, while the digital terrain model (DTM) shows the ground
level.</p>
<figure style="text-align: center"><img src="../fig/dsm-dtm.png" alt="The difference between DSM and DTM. Source: National Ecological Observatory Network (NEON)." width="1083" class="figure mx-auto d-block"><figcaption>
The difference between DSM and DTM. Source: National Ecological
Observatory Network (NEON).
</figcaption></figure><p>We will be looking at another model (the canopy/building height
model, or CHM) in <a href="16-raster-calculations.html">a later
episode</a> and will see how to calculate the CHM from the DSM and DTM.
Here, we will create a map of the Digital Terrain Model
(<code>DTM_TUD</code>) of TU Delft and its surrounding draped (or
layered) on top of the hillshade (<code>DTM_hill_TUD</code>).</p>
<div id="layering-rasters-hillshade" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="layering-rasters-hillshade" class="callout-inner">
<h3 class="callout-title">Layering Rasters: Hillshade</h3>
<div class="callout-content">
<p>We can layer a raster on top of a hillshade raster for the same area,
and use a transparency factor to create a 3-dimensional shaded effect. A
hillshade is a raster that maps the terrain using light and shadow to
create a 3D-looking image that you would see from above when viewing the
terrain. We will add a custom colour, making the plot grey.</p>
<p>Read more about layering rasters <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/02-raster-plot.html#layering-rasters" class="external-link">here</a>.</p>
</div>
</div>
</div>
<p>First, we need to import the DTM and DTM hillshade data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dtm-5m.tif"</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tud-dtm-5m-hill-WGS84.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, we will convert each of these datasets to a data frame for
plotting with <code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can create a map of the DTM layered over the hillshade.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_df</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/15-reproject-raster-data-rendered-plot-dtm-hill-1.png" style="display: block; margin: auto;" class="figure">
Our results are curious - neither the DTM (<code>DTM_TUD_df</code>) nor
the hillshade (<code>DTM_hill_TUD_df</code>) are plotted. Let’s try to
plot the DTM on its own to make sure the data are there.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/15-reproject-raster-data-rendered-plot-dtm-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Our DTM seems to contain data and plots just fine.</p>
<p>Next we plot the DTM Hillshade on its own to see whether everything
is OK.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/15-reproject-raster-data-rendered-plot-hill-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we examine the axes, we can see that the units (and thus the
projections) of the two rasters differ. In such cases,
<code>ggplot2</code> will still render the images, but they may not be
visible. The function doesn’t throw an error, but rather completes the
rendering process, which can make it seem like nothing is wrong. To
better understand this, we can compare the Coordinate Reference Systems
(CRSs) of the DTM and hillshade data to see how they differ.</p>
<div id="challenge-compare-the-crss" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-compare-the-crss" class="callout-inner">
<h3 class="callout-title">Challenge: compare the CRSs</h3>
<div class="callout-content">
<p>View the CRS for each of these two datasets. What projection does
each use?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "PROJCRS[\"Amersfoort / RD New\","
 [2] "    BASEGEOGCRS[\"Amersfoort\","
 [3] "        DATUM[\"Amersfoort\","
 [4] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"
 [5] "                LENGTHUNIT[\"metre\",1]]],"
 [6] "        PRIMEM[\"Greenwich\",0,"
 [7] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
 [8] "        ID[\"EPSG\",4289]],"
 [9] "    CONVERSION[\"RD New\","
[10] "        METHOD[\"Oblique Stereographic\","
[11] "            ID[\"EPSG\",9809]],"
[12] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[14] "            ID[\"EPSG\",8801]],"
[15] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"
[16] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[17] "            ID[\"EPSG\",8802]],"
[18] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"
[19] "            SCALEUNIT[\"unity\",1],"
[20] "            ID[\"EPSG\",8805]],"
[21] "        PARAMETER[\"False easting\",155000,"
[22] "            LENGTHUNIT[\"metre\",1],"
[23] "            ID[\"EPSG\",8806]],"
[24] "        PARAMETER[\"False northing\",463000,"
[25] "            LENGTHUNIT[\"metre\",1],"
[26] "            ID[\"EPSG\",8807]]],"
[27] "    CS[Cartesian,2],"
[28] "        AXIS[\"easting (X)\",east,"
[29] "            ORDER[1],"
[30] "            LENGTHUNIT[\"metre\",1]],"
[31] "        AXIS[\"northing (Y)\",north,"
[32] "            ORDER[2],"
[33] "            LENGTHUNIT[\"metre\",1]],"
[34] "    USAGE["
[35] "        SCOPE[\"Engineering survey, topographic mapping.\"],"
[36] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[37] "        BBOX[50.75,3.2,53.7,7.22]],"
[38] "    ID[\"EPSG\",28992]]"                                                                                               </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "GEOGCRS[\"WGS 84\","
 [2] "    DATUM[\"World Geodetic System 1984\","
 [3] "        ELLIPSOID[\"WGS 84\",6378137,298.257223563,"
 [4] "            LENGTHUNIT[\"metre\",1]]],"
 [5] "    PRIMEM[\"Greenwich\",0,"
 [6] "        ANGLEUNIT[\"degree\",0.0174532925199433]],"
 [7] "    CS[ellipsoidal,2],"
 [8] "        AXIS[\"geodetic latitude (Lat)\",north,"
 [9] "            ORDER[1],"
[10] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[11] "        AXIS[\"geodetic longitude (Lon)\",east,"
[12] "            ORDER[2],"
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[14] "    ID[\"EPSG\",4326]]"                                </code></pre>
</div>
<p><code>DTM_TUD</code> is in the Amersfoort / RD New projection,
whereas <code>DTM_hill_TUD</code> is in WGS 84.</p>
</div>
</div>
</div>
</div>
<p>Because the two rasters are in different CRSs, they do not line up
when plotted in R. We need to reproject (or change the projection of)
<code>DTM_hill_TUD</code> into the Amersfoort / RD New CRS (EPSG:
28992).</p>
</section><section><h2 class="section-heading" id="reproject-rasters">Reproject Rasters<a class="anchor" aria-label="anchor" href="#reproject-rasters"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>project()</code> function to reproject a raster
into a new CRS. Keep in mind that reprojection only works when you first
have a defined CRS for the raster object that you want to reproject. It
cannot be used if no CRS is defined. Lucky for us, DTM_hill_TUD has a
defined CRS.</p>
<div id="data-tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data tip</h3>
<div class="callout-content">
<p>When we reproject a raster, we move it from one “grid” to another.
Thus, we are modifying the data! Keep this in mind as we work with
raster data.</p>
</div>
</div>
</div>
<p>To use the <code>project()</code> function, we need to define two
things:</p>
<ol style="list-style-type: decimal">
<li>the object we want to reproject and</li>
<li>the CRS that we want to reproject it to.</li>
</ol>
<p>The syntax is <code>project(RasterObject, crs)</code></p>
<p>We want the CRS of our hillshade to match the <code>DTM_TUD</code>
raster. We can thus assign the CRS of our <code>DTM_TUD</code> to our
hillshade within the <code>project()</code> function as follows:
<code>crs(DTM_TUD)</code>. Note that we are using the
<code>project()</code> function on the raster object, not the
<code>data.frame()</code> we use for plotting with
<code>ggplot</code>.</p>
<p>First we will reproject our <code>DTM_hill_TUD</code> raster data to
match the <code>DTM_TUD</code> raster CRS:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_EPSG28992_TUD</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>,</span>
<span>                                  <span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can compare the CRS of our original DTM hillshade and our new
DTM hillshade, to see how they are different.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "PROJCRS[\"Amersfoort / RD New\","
 [2] "    BASEGEOGCRS[\"Amersfoort\","
 [3] "        DATUM[\"Amersfoort\","
 [4] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"
 [5] "                LENGTHUNIT[\"metre\",1]]],"
 [6] "        PRIMEM[\"Greenwich\",0,"
 [7] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
 [8] "        ID[\"EPSG\",4289]],"
 [9] "    CONVERSION[\"RD New\","
[10] "        METHOD[\"Oblique Stereographic\","
[11] "            ID[\"EPSG\",9809]],"
[12] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[14] "            ID[\"EPSG\",8801]],"
[15] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"
[16] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[17] "            ID[\"EPSG\",8802]],"
[18] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"
[19] "            SCALEUNIT[\"unity\",1],"
[20] "            ID[\"EPSG\",8805]],"
[21] "        PARAMETER[\"False easting\",155000,"
[22] "            LENGTHUNIT[\"metre\",1],"
[23] "            ID[\"EPSG\",8806]],"
[24] "        PARAMETER[\"False northing\",463000,"
[25] "            LENGTHUNIT[\"metre\",1],"
[26] "            ID[\"EPSG\",8807]]],"
[27] "    CS[Cartesian,2],"
[28] "        AXIS[\"easting (X)\",east,"
[29] "            ORDER[1],"
[30] "            LENGTHUNIT[\"metre\",1]],"
[31] "        AXIS[\"northing (Y)\",north,"
[32] "            ORDER[2],"
[33] "            LENGTHUNIT[\"metre\",1]],"
[34] "    USAGE["
[35] "        SCOPE[\"Engineering survey, topographic mapping.\"],"
[36] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[37] "        BBOX[50.75,3.2,53.7,7.22]],"
[38] "    ID[\"EPSG\",28992]]"                                                                                               </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "GEOGCRS[\"WGS 84\","
 [2] "    DATUM[\"World Geodetic System 1984\","
 [3] "        ELLIPSOID[\"WGS 84\",6378137,298.257223563,"
 [4] "            LENGTHUNIT[\"metre\",1]]],"
 [5] "    PRIMEM[\"Greenwich\",0,"
 [6] "        ANGLEUNIT[\"degree\",0.0174532925199433]],"
 [7] "    CS[ellipsoidal,2],"
 [8] "        AXIS[\"geodetic latitude (Lat)\",north,"
 [9] "            ORDER[1],"
[10] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[11] "        AXIS[\"geodetic longitude (Lon)\",east,"
[12] "            ORDER[2],"
[13] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[14] "    ID[\"EPSG\",4326]]"                                </code></pre>
</div>
<p>We can also compare the extent of the two objects.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 83537.3768729672, 87200.5199626113, 445202.584641046, 447230.395994242 (xmin, xmax, ymin, ymax)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ext</span><span class="op">(</span><span class="va">DTM_hill_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatExtent : 4.34674898644234, 4.39970436836596, 51.9910492930106, 52.0088368700157 (xmin, xmax, ymin, ymax)</code></pre>
</div>
</section><section><h2 class="section-heading" id="deal-with-raster-resolution">Deal with Raster Resolution<a class="anchor" aria-label="anchor" href="#deal-with-raster-resolution"></a>
</h2>
<hr class="half-width">
<p>Let’s next have a look at the resolution of our reprojected hillshade
versus our original data.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5.03179 5.03179</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<p>Although these two rasters have different resolutions, they represent
the same data. We can tell R to force our newly reprojected raster to be
the same as <code>DTM_TUD</code> by adding a line of code
<code>res = res(DTM_TUD)</code> within the <code>project()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_EPSG28992_TUD</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span><span class="va">DTM_hill_TUD</span>, </span>
<span>                                  <span class="fu">crs</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span>,</span>
<span>                                  res <span class="op">=</span> <span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now both our resolutions and our CRSs match, so we can plot these two
data sets together. Let’s double-check our resolution to be sure:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">res</span><span class="op">(</span><span class="va">DTM_TUD</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5 5</code></pre>
</div>
<p>For plotting with <code>ggplot()</code>, we will need to create a
data frame from our newly reprojected raster.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_TUD_2_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_EPSG28992_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now create a plot of this data.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_TUD_2_df</span>, </span>
<span>                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">`tud-dtm-5m-hill`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/15-reproject-raster-data-rendered-plot-dtm-hill-projected-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We have now successfully draped the Digital Terrain Model on top of
our hillshade to produce a nice looking, textured map!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>In order to plot two raster data sets together, they must be in the
same CRS.</li>
<li>Use the <code>project()</code> function to convert between
CRSs.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-16-raster-calculations"><p>Content from <a href="16-raster-calculations.html">Raster Calculations</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/16-raster-calculations.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I subtract one raster from another and extract pixel values
for defined locations?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Perform a subtraction between two rasters using raster math.</li>
<li>Export raster data as a GeoTIFF file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this episode</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>We often want to combine values of and perform calculations on
rasters to create a new output raster. This episode covers how to
subtract one raster from another using basic raster math.</p>
<section><h2 class="section-heading" id="raster-calculations-in-r">Raster calculations in R<a class="anchor" aria-label="anchor" href="#raster-calculations-in-r"></a>
</h2>
<hr class="half-width">
<p>Let’s say we are interested in mapping the heights of trees and
buildings across an urban area. To that end, we can calculate the
difference between the Digital Surface Model (DSM, tops of trees and
buildings) and the Digital Terrain Model (DTM, ground level). The
resulting dataset is referred to as a Canopy Height Model (CHM) and
represents the actual height of trees, buildings, etc. with the
influence of ground elevation removed.</p>
<figure><img src="https://datacarpentry.org/r-raster-vector-geospatial/fig/dc-spatial-raster/lidarTree-height.png" alt="Source: National Ecological Observatory Network (NEON)." class="figure mx-auto d-block"><div class="figcaption">Source: National Ecological Observatory Network
(NEON).</div>
</figure></section><section><h2 class="section-heading" id="load-the-data">Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>For this episode, we will use the DTM and DSM data which we already
have loaded from previous episodes.</p>
<p>We use the <code>describe()</code> function to view information about
the DTM and DSM data files.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dtm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"
 [2] "Files: data/tud-dtm-5m.tif"
 [3] "Size is 722, 386"
 [4] "Coordinate System is:"
 [5] "PROJCRS[\"Amersfoort / RD New\","
 [6] "    BASEGEOGCRS[\"Amersfoort\","
 [7] "        DATUM[\"Amersfoort\","
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"
 [9] "                LENGTHUNIT[\"metre\",1]]],"
[10] "        PRIMEM[\"Greenwich\",0,"
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[12] "        ID[\"EPSG\",4289]],"
[13] "    CONVERSION[\"RD New\","
[14] "        METHOD[\"Oblique Stereographic\","
[15] "            ID[\"EPSG\",9809]],"
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[18] "            ID[\"EPSG\",8801]],"
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[21] "            ID[\"EPSG\",8802]],"
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"
[23] "            SCALEUNIT[\"unity\",1],"
[24] "            ID[\"EPSG\",8805]],"
[25] "        PARAMETER[\"False easting\",155000,"
[26] "            LENGTHUNIT[\"metre\",1],"
[27] "            ID[\"EPSG\",8806]],"
[28] "        PARAMETER[\"False northing\",463000,"
[29] "            LENGTHUNIT[\"metre\",1],"
[30] "            ID[\"EPSG\",8807]]],"
[31] "    CS[Cartesian,2],"
[32] "        AXIS[\"easting (X)\",east,"
[33] "            ORDER[1],"
[34] "            LENGTHUNIT[\"metre\",1]],"
[35] "        AXIS[\"northing (Y)\",north,"
[36] "            ORDER[2],"
[37] "            LENGTHUNIT[\"metre\",1]],"
[38] "    USAGE["
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"
[42] "    ID[\"EPSG\",28992]]"
[43] "Data axis to CRS axis mapping: 1,2"
[44] "Origin = (83565.000000000000000,447180.000000000000000)"
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"
[46] "Metadata:"
[47] "  AREA_OR_POINT=Area"
[48] "Image Structure Metadata:"
[49] "  INTERLEAVE=BAND"
[50] "Corner Coordinates:"
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/tud-dsm-5m.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"
 [2] "Files: data/tud-dsm-5m.tif"
 [3] "Size is 722, 386"
 [4] "Coordinate System is:"
 [5] "PROJCRS[\"Amersfoort / RD New\","
 [6] "    BASEGEOGCRS[\"Amersfoort\","
 [7] "        DATUM[\"Amersfoort\","
 [8] "            ELLIPSOID[\"Bessel 1841\",6377397.155,299.1528128,"
 [9] "                LENGTHUNIT[\"metre\",1]]],"
[10] "        PRIMEM[\"Greenwich\",0,"
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"
[12] "        ID[\"EPSG\",4289]],"
[13] "    CONVERSION[\"RD New\","
[14] "        METHOD[\"Oblique Stereographic\","
[15] "            ID[\"EPSG\",9809]],"
[16] "        PARAMETER[\"Latitude of natural origin\",52.1561605555556,"
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[18] "            ID[\"EPSG\",8801]],"
[19] "        PARAMETER[\"Longitude of natural origin\",5.38763888888889,"
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"
[21] "            ID[\"EPSG\",8802]],"
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9999079,"
[23] "            SCALEUNIT[\"unity\",1],"
[24] "            ID[\"EPSG\",8805]],"
[25] "        PARAMETER[\"False easting\",155000,"
[26] "            LENGTHUNIT[\"metre\",1],"
[27] "            ID[\"EPSG\",8806]],"
[28] "        PARAMETER[\"False northing\",463000,"
[29] "            LENGTHUNIT[\"metre\",1],"
[30] "            ID[\"EPSG\",8807]]],"
[31] "    CS[Cartesian,2],"
[32] "        AXIS[\"easting (X)\",east,"
[33] "            ORDER[1],"
[34] "            LENGTHUNIT[\"metre\",1]],"
[35] "        AXIS[\"northing (Y)\",north,"
[36] "            ORDER[2],"
[37] "            LENGTHUNIT[\"metre\",1]],"
[38] "    USAGE["
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"
[40] "        AREA[\"Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone.\"],"
[41] "        BBOX[50.75,3.2,53.7,7.22]],"
[42] "    ID[\"EPSG\",28992]]"
[43] "Data axis to CRS axis mapping: 1,2"
[44] "Origin = (83565.000000000000000,447180.000000000000000)"
[45] "Pixel Size = (5.000000000000000,-5.000000000000000)"
[46] "Metadata:"
[47] "  AREA_OR_POINT=Area"
[48] "Image Structure Metadata:"
[49] "  INTERLEAVE=BAND"
[50] "Corner Coordinates:"
[51] "Upper Left  (   83565.000,  447180.000) (  4d20'49.32\"E, 52d 0'33.67\"N)"
[52] "Lower Left  (   83565.000,  445250.000) (  4d20'50.77\"E, 51d59'31.22\"N)"
[53] "Upper Right (   87175.000,  447180.000) (  4d23'58.60\"E, 52d 0'35.30\"N)"
[54] "Lower Right (   87175.000,  445250.000) (  4d23'59.98\"E, 51d59'32.85\"N)"
[55] "Center      (   85370.000,  446215.000) (  4d22'24.67\"E, 52d 0' 3.27\"N)"
[56] "Band 1 Block=722x2 Type=Float32, ColorInterp=Gray"                                                                     </code></pre>
</div>
<p>We have already loaded and worked with these two data files in
earlier episodes. Let’s plot them each once more to remind ourselves
what this data looks like. First we plot the DTM elevation data:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_TUD_df</span> , </span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dtm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/16-raster-calculations-rendered-plot-dtm-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And then the DSM elevation data:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_TUD_df</span> , </span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/16-raster-calculations-rendered-plot-dsm-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="raster-math-and-canopy-height-models">Raster math and Canopy Height Models<a class="anchor" aria-label="anchor" href="#raster-math-and-canopy-height-models"></a>
</h2>
<hr class="half-width">
<p>We can perform raster calculations by subtracting (or adding,
multiplying, etc.) two rasters. In the geospatial world, we call this
“raster math”.</p>
<p>Let’s subtract the DTM from the DSM to create a Canopy Height Model.
After subtracting, let’s create a data frame so we can plot with
<code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_TUD</span> <span class="op">&lt;-</span> <span class="va">DSM_TUD</span> <span class="op">-</span> <span class="va">DTM_TUD</span></span>
<span><span class="va">CHM_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now plot the output CHM.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_TUD_df</span> , </span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Canopy Height"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/16-raster-calculations-rendered-plot-chm-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Let’s have a look at the distribution of values in our newly created
Canopy Height Model (CHM).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/16-raster-calculations-rendered-chm-hist-1.png" style="display: block; margin: auto;" class="figure">
Notice that the range of values for the output CHM starts right below 0
and ranges to almost 100 meters. Does this make sense for buildings and
trees in Delft?</p>
<div id="challenge-explore-chm-raster-values" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-explore-chm-raster-values" class="callout-inner">
<h3 class="callout-title">Challenge: Explore CHM Raster Values</h3>
<div class="callout-content">
<p>It is often a good idea to explore the range of values in a raster
dataset just like we might explore a dataset that we collected in the
field.</p>
<ol style="list-style-type: decimal">
<li>What is the minimum and maximum value for the Canopy Height Model
<code>CHM_TUD</code> that we just created?</li>
<li>What is the distribution of all the pixel values in the CHM?</li>
<li>Plot the <code>CHM_TUD</code> raster using breaks that make sense
for the data.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">$</span><span class="va">`tud-dsm-5m`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -3.638057</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">$</span><span class="va">`tud-dsm-5m`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 92.08102</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">CHM_TUD_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/16-raster-calculations-rendered-chm-challenge-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">CHM_TUD_df</span> <span class="op">&lt;-</span> <span class="va">CHM_TUD_df</span> <span class="op">%&gt;%</span></span>
<span>                  <span class="fu">mutate</span><span class="op">(</span>canopy_discrete <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">`tud-dsm-5m`</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_TUD_df</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                       fill <span class="op">=</span> <span class="va">canopy_discrete</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/16-raster-calculations-rendered-chm-challenge-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="two-ways-to-perform-raster-calculations" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="two-ways-to-perform-raster-calculations" class="callout-inner">
<h3 class="callout-title">Two Ways to Perform Raster Calculations</h3>
<div class="callout-content">
<p>We can calculate the difference between two rasters in two different
ways:</p>
<ul>
<li>by directly subtracting the two rasters in R using raster math, as
we did above,</li>
</ul>
<p>or for more efficient processing, particularly if our rasters are
large and/or the calculations we are performing are complex:</p>
<ul>
<li>using the <code>lapp()</code> function.</li>
</ul>
<p>See how <code>lapp()</code> is used in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/04-raster-calculations-in-r.html#efficient-raster-calculations" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="export-a-geotiff">Export a GeoTIFF<a class="anchor" aria-label="anchor" href="#export-a-geotiff"></a>
</h2>
<hr class="half-width">
<p>Now that we have created a new raster, let’s export the data as a
GeoTIFF file using the <code>writeRaster()</code> function. A GeoTIFF is
a metadata standard that has the georeferencing information embedded
within the image.</p>
<p>When we write this raster object to a GeoTIFF file we name it
<code>CHM_TUD.tiff</code>. This name allows us to quickly remember both
what the data contains (CHM data) and for where (TU Delft campus and
surroundings). The <code>writeRaster()</code> function by default writes
the output file to your working directory unless you specify a full file
path.</p>
<p>We will specify the output format <code>"GTiff"</code> and tell R to
overwrite any data that is already in a file of the same name.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">CHM_TUD</span>, <span class="st">"fig/CHM_TUD.tiff"</span>,</span>
<span>            filetype <span class="op">=</span> <span class="st">"GTiff"</span>,</span>
<span>            overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Rasters can be computed on using mathematical functions.</li>
<li>The <code>writeRaster()</code> function can be used to write raster
data to a file.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-17-work-with-multi-band-rasters"><p>Content from <a href="17-work-with-multi-band-rasters.html">Work with Multi-Band Rasters</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/17-work-with-multi-band-rasters.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I visualize individual and multiple bands in a raster
object?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Identify a single versus a multi-band raster file.</li>
<li>Import multi-band rasters into R using the <code>terra</code>
package.</li>
<li>Plot multi-band colour image rasters in R using the
<code>ggplot</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="things-youll-need-to-complete-this-episode" class="callout-inner">
<h3 class="callout-title">Things you’ll need to complete this episode</h3>
<div class="callout-content">
<p>See the <a href="index.html#setup">setup instructions</a> for detailed
information about the software, data, and other prerequisites you will
need to work through the examples in this episode.</p>
<!-- This lesson uses the `terra` package in particular. If you have not installed it yet, do so by running `install.packages("terra")` before loading it with `library(terra)`. -->
</div>
</div>
</div>
<p>This episode explores how to import and plot a multi-band raster in
R.</p>
<section><h2 class="section-heading" id="getting-started-with-multi-band-data-in-r">Getting Started with Multi-Band Data in R<a class="anchor" aria-label="anchor" href="#getting-started-with-multi-band-data-in-r"></a>
</h2>
<hr class="half-width">
<p>The multi-band data that we are working with is <a href="https://opendata.beeldmateriaal.nl/" class="external-link">Beeldmateriaal Open Data</a>
from the Netherlands. Each RGB image is a 3-band raster. The same steps
would apply to working with a multi-spectral image with 4 or more bands
like Landsat imagery.</p>
<p>By using the <code>rast()</code> function along with the
<code>lyrs</code> parameter, we can read specific raster bands; omitting
this parameter would read instead all bands. We specify which band we
want with <code>lyrs = N</code> (N represents the band number we want to
work with). To import the red band, we would use
<code>lyrs = 1</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band1_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span>, lyrs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>We need to convert this data to a data frame in order to plot it with
<code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band1_TUD_df</span>  <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_band1_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting this can take up to 1 minute</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_band1_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/17-work-with-multi-band-rasters-rendered-plot-rgb-band1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="image-raster-data-values">Image Raster Data Values<a class="anchor" aria-label="anchor" href="#image-raster-data-values"></a>
</h2>
<hr class="half-width">
<p>This raster contains values between 0 and 255. These values represent
degrees of brightness associated with the image band. In the case of a
RGB image (red, green and blue), band 1 is the red band. When we plot
the red band, larger numbers (towards 255) represent pixels with more
red in them (a strong red reflection). Smaller numbers (towards 0)
represent pixels with less red in them (less red was reflected). To plot
an RGB image, we mix red + green + blue values into one single colour to
create a full colour image - similar to the colour image a digital
camera creates.</p>
<div id="importing-a-specific-band" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="importing-a-specific-band" class="callout-inner">
<h3 class="callout-title">Importing a Specific Band</h3>
<div class="callout-content">
<p>We can use the <code>rast()</code> function to import specific bands
in our raster object by specifying which band we want with
<code>lyrs = N</code> (N represents the band number we want to work
with). To import the green band, we would use <code>lyrs = 2</code>. We
can convert this data to a data frame and plot the same way we plotted
the red band.</p>
<p>Import and plot the green band.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_band2_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span>, lyrs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RGB_band2_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_band2_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_band2_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_2`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/17-work-with-multi-band-rasters-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="raster-stacks">Raster Stacks<a class="anchor" aria-label="anchor" href="#raster-stacks"></a>
</h2>
<hr class="half-width">
<p>Next, we will work with all three image bands (red, green and blue)
as an R raster object. We will then plot a 3-band composite, or
full-colour, image.</p>
<p>To bring in all bands of a multi-band raster, we use the
<code>rast()</code> function without specifying a <code>lyrs</code>
value.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/tudlib-rgb.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s preview the attributes of our stack object:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster
dimensions  : 4988, 4866, 3  (nrow, ncol, nlyr)
resolution  : 0.08, 0.08  (x, y)
extent      : 85272, 85661.28, 446295.2, 446694.2  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992)
source      : tudlib-rgb.tif
colors RGB  : 1, 2, 3
names       : tudlib-rgb_1, tudlib-rgb_2, tudlib-rgb_3 </code></pre>
</div>
<p>We can view the attributes of each band in the stack in a single
output. For example, if we had hundreds of bands, we could specify which
band we would like to view attributes for using an index value:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster
dimensions  : 4988, 4866, 1  (nrow, ncol, nlyr)
resolution  : 0.08, 0.08  (x, y)
extent      : 85272, 85661.28, 446295.2, 446694.2  (xmin, xmax, ymin, ymax)
coord. ref. : Amersfoort / RD New (EPSG:28992)
source      : tudlib-rgb.tif
name        : tudlib-rgb_2 </code></pre>
</div>
<p>We can also use <code>ggplot2</code> to plot the data in any layer of
our raster object. Remember, we need to convert to a data frame
first.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RGB_stack_TUD_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">RGB_stack_TUD</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Each band in our raster stack gets its own column in the data frame.
Thus we have:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">RGB_stack_TUD_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	24271608 obs. of  5 variables:
 $ x           : num  85272 85272 85272 85272 85272 ...
 $ y           : num  446694 446694 446694 446694 446694 ...
 $ tudlib-rgb_1: int  52 48 47 49 47 45 47 48 49 54 ...
 $ tudlib-rgb_2: int  64 58 57 60 57 55 58 59 62 69 ...
 $ tudlib-rgb_3: int  57 49 49 53 50 47 51 54 57 68 ...</code></pre>
</div>
<p>Let’s create a raster plot of the second band:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting this can take up to 1 minute</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">RGB_stack_TUD_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">`tudlib-rgb_2`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/17-work-with-multi-band-rasters-rendered-plot-rgb-band2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can access any individual band in the same way.</p>
</section><section><h2 class="section-heading" id="plotting-a-three-band-image">Plotting a three-band image<a class="anchor" aria-label="anchor" href="#plotting-a-three-band-image"></a>
</h2>
<hr class="half-width">
<p>To render a final three-band, coloured image in R, we use the
<code>plotRGB()</code> function.</p>
<p>This function allows us to:</p>
<ul>
<li>Identify what bands we want to render in the red, green and blue
regions. The <code>plotRGB()</code> function defaults to a 1=red,
2=green, and 3=blue band order. However, you can define what bands you
would like to plot manually. Manual definition of bands is useful if you
have, for example, a near-infrared band and want to create a colour
infrared image.</li>
<li>Adjust the stretch of the image to increase or decrease
contrast.</li>
</ul>
<p>Let’s plot our 3-band image. Note that we can use the
<code>plotRGB()</code> function directly with our raster stack object
(we do not need a data frame as this function is not part of the
<code>ggplot2</code> package).</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">RGB_stack_TUD</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, g <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/17-work-with-multi-band-rasters-rendered-plot-rgb-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The image above looks pretty good. We can explore whether applying a
stretch to the image might improve clarity and contrast using
stretch=“lin” or stretch=“hist”, as explained in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html#create-a-three-band-image" class="external-link">this
lesson</a>.</p>
<div id="spatraster-in-r" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="spatraster-in-r" class="callout-inner">
<h3 class="callout-title">SpatRaster in R</h3>
<div class="callout-content">
<p>The R SpatRaster object type can handle rasters with multiple bands.
The SpatRaster only holds parameters that describe the properties of
raster data that is located somewhere on our computer.</p>
<p>A SpatRasterDataset object can hold references to sub-datasets, that
is, SpatRaster objects. In most cases, we can work with a SpatRaster in
the same way we might work with a SpatRasterDataset.</p>
<p>Read more about SpatRasters in <a href="https://datacarpentry.org/r-raster-vector-geospatial/instructor/05-raster-multi-band-in-r.html#spatraster-in-r" class="external-link">this
lesson</a>.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A single raster file can contain multiple bands or layers.</li>
<li>Use the <code>rast()</code> function to load all bands in a
multi-layer raster file into R.</li>
<li>Individual bands within a SpatRaster can be accessed, analysed, and
visualized using the same functions no matter how many bands it
holds.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-18-import-and-visualise-osm-data"><p>Content from <a href="18-import-and-visualise-osm-data.html">Import and Visualise OSM Data</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/18-import-and-visualise-osm-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 70 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to import and work with vector data from OpenStreetMap?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Import OSM vector data from the API</li>
<li>Select and manipulate OSM vector data</li>
<li>Visualise and map OSM Vector data</li>
<li>Use Leaflet for interactive mapping</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-openstreetmap">What is OpenStreetMap?<a class="anchor" aria-label="anchor" href="#what-is-openstreetmap"></a>
</h2>
<hr class="half-width">
<p>OpenStreetMap (OSM) is a collaborative project which aims at mapping
the world and sharing geospatial data in an open way. Anyone can
contribute, by mapping geographical objects they encounter, by adding
topical information on existing map objects (their name, function,
capacity, etc.), or by mapping buildings and roads from satellite
imagery.</p>
<p>This information is then validated by other users and eventually
added to the common “map” or information system. This ensures that the
information is accessible, open, verified, accurate and up-to-date.</p>
<p>The result looks like this: <img src="../fig/OSM1.png" class="figure"></p>
<p>The geospatial data underlying this interface is made of geometrical
objects (i.e. points, lines, polygons) and their associated tags
(#building #height, #road #secondary #90kph, etc.).</p>
</section><section><h2 class="section-heading" id="how-to-extract-geospatial-data-from-openstreetmap">How to extract geospatial data from OpenStreetMap?<a class="anchor" aria-label="anchor" href="#how-to-extract-geospatial-data-from-openstreetmap"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="fu">assign</span><span class="op">(</span><span class="st">"has_internet_via_proxy"</span>, <span class="cn">TRUE</span>, <span class="fu">environment</span><span class="op">(</span><span class="fu">curl</span><span class="fu">::</span><span class="va">has_internet</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="bounding-box">Bounding box<a class="anchor" aria-label="anchor" href="#bounding-box"></a>
</h3>
<p>The first thing to do is to define the area within which you want to
retrieve data, aka the <em>bounding box</em>. This can be defined easily
using a place name and the package <code>osmdata</code> to access the
free Nominatim API provided by OpenStreetMap.</p>
<p>We are going to look at <em>Brielle</em> together.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Beware that downloading and analysing the data for larger cities
might be long, slow and cumbersome on your machine. If you choose
another location to work with, please try to choose a city of similar
size!</p>
</div>
</div>
</div>
<p>We first geocode our spatial text search and extract the
corresponding bounding box (<code>getbb</code>).</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">osmdata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu">getbb</span><span class="op">(</span><span class="st">"Brielle"</span><span class="op">)</span></span>
<span><span class="va">bb</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        min       max
x  4.135294  4.229222
y 51.883500 51.931410</code></pre>
</div>
<div id="overpass-query-unavailable-without-internet" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="overpass-query-unavailable-without-internet" class="callout-inner">
<h3 class="callout-title">Overpass query unavailable without internet</h3>
<div class="callout-content">
<p>If you encounter an error linked to your internet proxy (“Error:
Overpass query unavailable without internet R”), run this line of code.
It might not be needed, but ensures that your machine knows it has
internet.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">assign</span><span class="op">(</span><span class="st">"has_internet_via_proxy"</span>, <span class="cn">TRUE</span>, <span class="fu">environment</span><span class="op">(</span><span class="fu">curl</span><span class="fu">::</span><span class="va">has_internet</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="a-word-of-caution">A word of caution<a class="anchor" aria-label="anchor" href="#a-word-of-caution"></a>
</h3>
<p>There might be multiple responses from the API query, corresponding
to different objects at the same location, or different objects at
different locations. For example: Brielle (Netherlands) and Brielle (New
Jersey)</p>
<figure><img src="../fig/Brielle_NL.jpeg" style="width:40.0%" alt="Brielle, Netherlands" class="figure mx-auto d-block"><div class="figcaption">Brielle, Netherlands</div>
</figure><figure><img src="../fig/Brielle_NJ.jpeg" title="Brielle, New Jersey" style="width:40.0%" alt="Brielle, New Jersey" class="figure mx-auto d-block"><div class="figcaption">Brielle, New Jersey</div>
</figure><p>By default, <code>getbb()</code> from the <code>osmdata</code>
package returns the first item. This means that regardless of the number
of returned locations with the given name, the function will return a
bounding box and it might be that we are not looking for the first item.
We should therefore try to be as unambiguous as possible by adding a
country code or district name.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">getbb</span><span class="op">(</span><span class="st">"Brielle, NL"</span><span class="op">)</span></span>
<span><span class="va">bb</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        min       max
x  4.135294  4.229222
y 51.883500 51.931410</code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>If this does not work for some reason, the
<code>nominatim_polygon</code> can be found in the data folder:
“episodes/data/boundingboxBrielle.shp”.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="extracting-features">Extracting features<a class="anchor" aria-label="anchor" href="#extracting-features"></a>
</h2>
<hr class="half-width">
<p>A <a href="https://wiki.openstreetmap.org/wiki/Map_features" class="external-link">feature</a> in
the OSM language is a category or tag of a geospatial object. Features
are described by general keys (e.g. “building”, “boundary”, “landuse”,
“highway”), themselves decomposed into sub-categories (values) such as
“farm”, “hotel” or “house” for <code>buildings</code>, “motorway”,
“secondary” and “residential” for <code>highway</code>. This determines
how they are represented on the map.</p>
<div class="section level3">
<h3 id="searching-documentation">Searching documentation<a class="anchor" aria-label="anchor" href="#searching-documentation"></a>
</h3>
<p>Let’s say we want to download data from OpenStreetMap and we know
there is a package for it named <code>osmdata</code>, but we don’t know
which function to use and what arguments are needed. Where should we
start?</p>
<p>Let’s check the documentation <a href="https://docs.ropensci.org/osmdata/" class="external-link">online</a>:</p>
<figure><img src="../fig/osmdata.png" style="width:80.0%" alt="The OSMdata Documentation page" class="figure mx-auto d-block"><div class="figcaption">The OSMdata Documentation page</div>
</figure><p>It appears that there is a function to extract features, using the
Overpass API. This function is <code>opq()</code> (for OverPassQuery)
which, in combination with <code>add_osm_feature()</code>, seems to do
the job. However, it might not be crystal clear how to apply it to our
case. Let’s click on the function name in the documentation to find out
more.</p>
<figure><img src="../fig/opq.png" style="width:80.0%" alt="The Overpass Query Documentation page" class="figure mx-auto d-block"><div class="figcaption">The Overpass Query Documentation page</div>
</figure><p>On this page we can read about the arguments needed for each
function: a bounding box for <code>opq()</code> and some
<code>key</code> and <code>value</code> for
<code>add_osm_feature()</code>. Thanks to the examples provided, we can
assume that these keys and values correspond to different levels of tags
from the OSM classification. In our case, we will keep it at the first
level of classification, with “buildings” as <code>key</code>, and no
value. We also see from the examples that another function is needed
when working with the <code>sf</code> package:
<code>osmdata_sf()</code>. This ensures that the type of object is
suited for <code>sf</code>. With these tips and examples, we can write
our feature extraction function as follows:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">opq</span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bb</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">add_osm_feature</span><span class="op">(</span>key <span class="op">=</span> <span class="st">'building'</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">osmdata_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in overpass_query(query = obj$overpass_call, quiet = quiet, encoding = encoding): object 'doc' not found</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="structure-of-objects">Structure of objects<a class="anchor" aria-label="anchor" href="#structure-of-objects"></a>
</h3>
<p>What is this <code>x</code> object made of? It is a data frame of all
the buildings contained in the bounding box, which gives us their OSM
id, their geometry and a range of attributes, such as their name,
building material, building date, etc. The completion level of this data
frame depends on user contributions and open resources. Here, for
instance, the national <a href="https://data.overheid.nl/dataset/10491-bag" class="external-link">BAG</a> dataset was
used and it is quite complete, but that is different in other
countries.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">osm_polygons</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'x' not found</code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="mapping">Mapping<a class="anchor" aria-label="anchor" href="#mapping"></a>
</h2>
<hr class="half-width">
<p>Let’s map the building age of post-1900 Brielle buildings.</p>
<div class="section level3">
<h3 id="projections">Projections<a class="anchor" aria-label="anchor" href="#projections"></a>
</h3>
<p>First, we are going to select the polygons and reproject them with
the Amersfoort/RD New projection, suited for maps centred on the
Netherlands. This code for this projection is: 28992.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">osm_polygons</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">28992</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'x' not found</code></pre>
</div>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>If this does not work for some reason, the <code>buildings</code> can
be found in the data folder: “episodes/data/dataBrielle.shp”.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h3>
<p>Then we create a new variable using the threshold at 1900. Every date
before 1900 will be recoded as <code>1900</code>, so that buildings
older than 1900 will be represented with the same shade.</p>
<p>Then we use the <code>ggplot()</code> function to visualise the
buildings by age. The specific function to represent information as a
map is <code>geom_sf()</code>. The rest works like other graphs and
visualisation, with <code>aes()</code> for the aesthetics.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">buildings</span><span class="op">$</span><span class="va">start_date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'buildings' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span><span class="op">$</span><span class="va">build_date</span> <span class="op">&lt;-</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">start_date</span> <span class="op">&lt;</span> <span class="fl">1900</span>, <span class="fl">1900</span>, <span class="va">start_date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'start_date' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">build_date</span>, colour<span class="op">=</span><span class="va">build_date</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>   <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">scale_colour_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'buildings' not found</code></pre>
</div>
<p>So this reveals the historical centre of Brielle (or the city you
chose) and the various urban extensions through time. Anything odd?
What? Around the centre? Why these limits / isolated points?</p>
</div>
</section><section><h2 class="section-heading" id="replicability">Replicability<a class="anchor" aria-label="anchor" href="#replicability"></a>
</h2>
<hr class="half-width">
<p>We have produced a proof a concept on Brielle, but can we factorise
our work to be replicable with other small fortified cities? You can use
any of the following cities: <em>Naarden</em>, <em>Geertruidenberg</em>,
<em>Gorinchem</em>, <em>Enkhuizen</em> or <em>Dokkum</em>.</p>
<p>We might replace the name in the first line and run everything again.
Or we can create a function.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract_buildings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cityname</span>, <span class="va">year</span><span class="op">=</span><span class="fl">1900</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">getbb</span><span class="op">(</span><span class="va">cityname</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">opq</span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bb</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>     <span class="fu">add_osm_feature</span><span class="op">(</span>key <span class="op">=</span> <span class="st">'building'</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>     <span class="fu">osmdata_sf</span><span class="op">(</span><span class="op">)</span></span>
<span>     </span>
<span>  <span class="va">buildings</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">osm_polygons</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">28992</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">buildings</span><span class="op">$</span><span class="va">start_date</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">buildings</span><span class="op">$</span><span class="va">build_date</span> <span class="op">&lt;-</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">start_date</span> <span class="op">&lt;</span> <span class="va">year</span>, <span class="va">year</span>, <span class="va">start_date</span><span class="op">)</span></span>
<span>   <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">build_date</span>, colour<span class="op">=</span><span class="va">build_date</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">scale_colour_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">ggtitle</span><span class="op">(</span><span class="fu">paste0</span><span class="op">(</span><span class="st">"Old buildings in "</span>,<span class="va">cityname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#test on Brielle</span></span>
<span><span class="fu">extract_buildings</span><span class="op">(</span><span class="st">"Brielle, NL"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/18-import-and-visualise-osm-data-rendered-Replicability-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test on Naarden</span></span>
<span><span class="fu">extract_buildings</span><span class="op">(</span><span class="st">"Naarden, NL"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/18-import-and-visualise-osm-data-rendered-Replicability-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-import-an-interactive-basemap-layer-under-the-buildings-with-leaflet-20min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-import-an-interactive-basemap-layer-under-the-buildings-with-leaflet-20min" class="callout-inner">
<h3 class="callout-title">Challenge: import an interactive basemap layer under the buildings with ‘Leaflet’ (20min)</h3>
<div class="callout-content">
<p>Leaflet is a <a href="https://leafletjs.com/" class="external-link">“open-source JavaScript
library for mobile-friendly interactive maps”</a>. Within R, the
<code>leaflet</code> package allows you to build such interactive maps.
As with <code>ggplot2</code>, you build a map with a collection of
layers. In this case, you will have the leaflet basemap, some tiles, and
shapes on top (such as markers, polygons, etc.).</p>
<ul>
<li>Check out the <a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet
package documentation</a> and <a href="https://github.com/ClementineCttn/r-geospatial-urban/blob/main/instructors/cheatsheet/GDCU_cheatsheet.pdf" class="external-link">GDCU
cheatsheet</a>.</li>
<li>Plot a basemap in Leaflet and try different tiles in the <a href="https://rstudio.github.io/leaflet/basemaps.html" class="external-link">basemap
documentation</a>
</li>
<li>Transform the buildings into WGS84 projection and add them to the
basemap layer with the <code>addPolygons()</code> function.</li>
<li>Have the <code>fillColor</code> of these polygons represent the
<code>build_date</code> variable. See the <a href="https://rstudio.github.io/leaflet/choropleths.html" class="external-link">choropleth
documentation</a> and <a href="https://github.com/ClementineCttn/r-geospatial-urban/blob/main/instructors/cheatsheet/GDCU_cheatsheet.pdf" class="external-link">GDCU
cheatsheet</a> for how use to use fill colors in polygons. Tip: use the
examples given in the documentation and replace the variable names where
needed.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> One solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("leaflet")</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">buildings2</span> <span class="op">&lt;-</span> <span class="va">buildings</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'buildings' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># leaflet(buildings2) %&gt;%</span></span>
<span><span class="co">#  addTiles() %&gt;%</span></span>
<span><span class="co">#   addPolygons(fillColor = ~colorQuantile("YlGnBu", -build_date)(-build_date))</span></span>
<span></span>
<span> <span class="co"># For a better visual rendering, try:</span></span>
<span>  </span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="va">buildings2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">addProviderTiles</span><span class="op">(</span><span class="va">providers</span><span class="op">$</span><span class="va">CartoDB.Positron</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">addPolygons</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#444444"</span>, weight <span class="op">=</span> <span class="fl">0.1</span>, smoothFactor <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  opacity <span class="op">=</span> <span class="fl">0.2</span>, fillOpacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  fillColor <span class="op">=</span> <span class="op">~</span><span class="fu">colorQuantile</span><span class="op">(</span><span class="st">"YlGnBu"</span>, <span class="op">-</span><span class="va">build_date</span><span class="op">)</span><span class="op">(</span><span class="op">-</span><span class="va">build_date</span><span class="op">)</span>,</span>
<span>  highlightOptions <span class="op">=</span> <span class="fu">highlightOptions</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    bringToFront <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'buildings2' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>Nominatim</code> and <code>Overpass</code> APIs within
R</li>
<li>Use the <code>osmdata</code> package to retrieve geospatial
data</li>
<li>Select features and attributes among OSM tags</li>
<li>Use the <code>ggplot</code>, <code>sf</code> and
<code>leaflet</code> packages to map data</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-19-basic-gis-with-r-sf"><p>Content from <a href="19-basic-gis-with-r-sf.html">Basic GIS operations with R and sf</a></p>
<hr>
<p>Last updated on 2025-05-13 |

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/episodes/19-basic-gis-with-r-sf.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 70 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to perform basic GIS operations with the <code>sf</code>
package?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to…</p>
<ul>
<li>Perform geoprocessing operations such as unions, joins and
intersections with dedicated functions from the <code>sf</code>
package</li>
<li>Compute the area of spatial polygons</li>
<li>Create buffers and centroids</li>
<li>Map and save the results</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">osmdata</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">lwgeom</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">units</span><span class="op">)</span></span>
<span><span class="fu">assign</span><span class="op">(</span><span class="st">"has_internet_via_proxy"</span>, <span class="cn">TRUE</span>, <span class="fu">environment</span><span class="op">(</span><span class="fu">curl</span><span class="fu">::</span><span class="va">has_internet</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<section><h2 class="section-heading" id="why-sf-for-gis">Why <code>sf</code> for GIS?<a class="anchor" aria-label="anchor" href="#why-sf-for-gis"></a>
</h2>
<hr class="half-width">
<p>As introduced in <a href="09-open-and-plot-vector-layers.html">an
earlier lesson</a>, <code>sf</code> is a package which supports simple
features (sf), <a href="https://cran.r-project.org/web/packages/sf/sf.pdf" class="external-link">“a standardized
way to encode spatial vector data.”</a>. It contains a large set of
functions to achieve all the operations on vector spatial data for which
you might use traditional GIS software: change the coordinate system,
join layers, intersect or unite polygons, create buffers and centroids,
etc. cf. the <code>sf</code> <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/sf.pdf" class="external-link">cheatsheet</a>.</p>
<div class="section level3">
<h3 id="conservation-in-brielle-nl">Conservation in Brielle, NL<a class="anchor" aria-label="anchor" href="#conservation-in-brielle-nl"></a>
</h3>
<p>Let’s focus on old buildings and imagine we’re in charge of their
conservation. We want to know how much of the city would be affected by
a non-construction zone of 100m around pre-1800 buildings.</p>
<p>Let’s select them and see where they are.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu">getbb</span><span class="op">(</span><span class="st">"Brielle, NL"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">opq</span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bb</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">add_osm_feature</span><span class="op">(</span>key <span class="op">=</span> <span class="st">'building'</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">osmdata_sf</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">buildings</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">osm_polygons</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">28992</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">buildings</span><span class="op">$</span><span class="va">start_date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   Length     Class      Mode
    10701 character character </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fl">1800</span>  <span class="co"># year prior to which you consider a building old</span></span>
<span></span>
<span><span class="va">buildings</span><span class="op">$</span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">buildings</span><span class="op">$</span><span class="va">start_date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">old_buildings</span> <span class="op">&lt;-</span> <span class="va">buildings</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">start_date</span> <span class="op">&lt;=</span> <span class="va">old</span><span class="op">)</span></span>
<span></span>
<span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">old_buildings</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-recap-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="overpass-query-unavailable-without-internet" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="overpass-query-unavailable-without-internet" class="callout-inner">
<h3 class="callout-title">Overpass query unavailable without internet</h3>
<div class="callout-content">
<p>If you encounter an error linked to your internet proxy (“Error:
Overpass query unavailable without internet R”), run this line of code.
It might not be needed, but ensures that your machine knows it has
internet.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">assign</span><span class="op">(</span><span class="st">"has_internet_via_proxy"</span>, <span class="cn">TRUE</span>, <span class="fu">environment</span><span class="op">(</span><span class="fu">curl</span><span class="fu">::</span><span class="va">has_internet</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>As conservationists, we want to create a zone around historical
buildings where building regulation will have special restrictions to
preserve historical buildings.</p>
</div>
</section><section><h2 class="section-heading" id="buffers">Buffers<a class="anchor" aria-label="anchor" href="#buffers"></a>
</h2>
<hr class="half-width">
<p>Let’s say the conservation zone should be 100 meters. In GIS terms,
we want to create a <em>buffer</em> around polygons. The corresponding
<code>sf</code> function is <code>st_buffer()</code>, with 2 arguments:
the polygons around which to create buffers, and the radius of the
buffer.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># in meters </span></span>
<span> </span>
<span><span class="co">#First, we check that the "old_buildings" layer projection is measured in meters:</span></span>
<span><span class="fu">st_crs</span><span class="op">(</span><span class="va">old_buildings</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: EPSG:28992
  wkt:
PROJCRS["Amersfoort / RD New",
    BASEGEOGCRS["Amersfoort",
        DATUM["Amersfoort",
            ELLIPSOID["Bessel 1841",6377397.155,299.1528128,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4289]],
    CONVERSION["RD New",
        METHOD["Oblique Stereographic",
            ID["EPSG",9809]],
        PARAMETER["Latitude of natural origin",52.1561605555556,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",5.38763888888889,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9999079,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",155000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",463000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting (X)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["northing (Y)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["Netherlands - onshore, including Waddenzee, Dutch Wadden Islands and 12-mile offshore coastal zone."],
        BBOX[50.75,3.2,53.7,7.22]],
    ID["EPSG",28992]]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#then we use `st_buffer()`</span></span>
<span><span class="va">buffer_old_buildings</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>x <span class="op">=</span> <span class="va">old_buildings</span>, dist <span class="op">=</span> <span class="va">distance</span><span class="op">)</span></span>
<span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">buffer_old_buildings</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-buffer-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="union">Union<a class="anchor" aria-label="anchor" href="#union"></a>
</h2>
<hr class="half-width">
<p>Now, we have a lot of overlapping buffers. We would rather create a
unique conservation zone rather than overlapping ones in that case. So
we have to fuse the overlapping buffers into one polygon. This operation
is called <em>union</em> and the corresponding function is
<code>st_union()</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_old_buffer</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="va">buffer_old_buildings</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span>to <span class="op">=</span> <span class="st">"POLYGON"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_as_sf</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">single_old_buffer</span><span class="op">&lt;-</span> <span class="va">single_old_buffer</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="st">"ID"</span><span class="op">=</span><span class="fu">as.factor</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">single_old_buffer</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">28992</span><span class="op">)</span> </span></code></pre>
</div>
<p>We also use <code>st_cast()</code> to explicit the type of the
resulting object (<em>POLYGON</em> instead of the default
<em>MULTIPOLYGON</em>) and <code>st_as_sf()</code> to transform the
polygon into an <code>sf</code> object. With this function, we ensure
that we end up with an <code>sf</code> object, which was not the case
after we forced the union of old buildings into a <em>POLYGON</em>
format.</p>
<p>We create unique IDs to identify the new polygons.</p>
</section><section><h2 class="section-heading" id="centroids">Centroids<a class="anchor" aria-label="anchor" href="#centroids"></a>
</h2>
<hr class="half-width">
<p>For the sake of visualisation speed, we would like to represent
buildings by a single point (for instance: their geometric centre)
rather than their actual footprint. This operation means defining their
<em>centroid</em> and the corresponding function is
<code>st_centroid()</code>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu">sf_use_s2</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># s2 works with geographic projections, so to calculate centroids in projected CRS units (meters), we need to disable it.</span></span>
<span></span>
<span><span class="va">centroids_old</span> <span class="op">&lt;-</span> <span class="fu">st_centroid</span><span class="op">(</span><span class="va">old_buildings</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">28992</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">single_old_buffer</span>, <span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids_old</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-centroids-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="intersection">Intersection<a class="anchor" aria-label="anchor" href="#intersection"></a>
</h2>
<hr class="half-width">
<p>Now, we would like to distinguish conservation areas based on the
number of historic buildings they contain. In GIS terms, we would like
to know how many centroids each fused buffer polygon contains. This
operation means <em>intersecting</em> the layer of polygons with the
layer of points and the corresponding function is
<code>st_intersection()</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">centroids_buffers</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">st_intersection</span><span class="op">(</span><span class="va">centroids_old</span>,<span class="va">single_old_buffer</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">centroid_by_buffer</span> <span class="op">&lt;-</span> <span class="va">centroids_buffers</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span> <span class="va">single_buffer</span> <span class="op">&lt;-</span> <span class="va">single_old_buffer</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">mutate</span><span class="op">(</span>n_buildings <span class="op">=</span> <span class="va">centroid_by_buffer</span><span class="op">$</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">single_buffer</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">n_buildings</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                        begin <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        end <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                        option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">coord_sf</span><span class="op">(</span>datum <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="fl">28992</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-intersection-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><code>st_intersection</code> here adds the attributes of the
intersected polygon buffers to the data table of the centroids. This
means we will now know about each centroid, the ID of its intersected
polygon-buffer, and a variable called “n” which is population with 1 for
everyone. This means that all centroids will have the same weight when
aggregated.</p>
<p>We aggregate them by ID number (<code>group_by(ID)</code>) and sum
the variable <code>n</code> to know how many centroids are contained in
each polygon-buffer.</p>
<div class="section level3">
<h3 id="maps-of-the-number-of-buildings-per-zone">Maps of the number of buildings per zone:<a class="anchor" aria-label="anchor" href="#maps-of-the-number-of-buildings-per-zone"></a>
</h3>
<p>Let’s map this layer over the initial map of individual
buildings.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">single_buffer</span>, <span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">n_buildings</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        begin <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        end <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                        option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-mapping-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</section><section><h2 class="section-heading" id="calculating-area-and-density-of-spatial-features">Calculating area and density of spatial features<a class="anchor" aria-label="anchor" href="#calculating-area-and-density-of-spatial-features"></a>
</h2>
<hr class="half-width">
<p>In our analysis, we have a large number of pre-war buildings, and the
buffer zones we’re using are quite broad. As a result, the total count
of old buildings within these zones doesn’t provide us with the most
meaningful insight. To make our analysis more useful, we should
calculate the density of pre-war buildings within each buffer zone. This
will help us better understand how these buildings are distributed
across the area, providing more relevant and actionable information for
our project.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_buffer</span><span class="op">$</span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu">st_area</span><span class="op">(</span><span class="va">single_buffer</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">.</span>, <span class="va">km</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">single_buffer</span><span class="op">$</span><span class="va">old_buildings_per_km2</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">single_buffer</span><span class="op">$</span><span class="va">n_buildings</span> <span class="op">/</span> <span class="va">single_buffer</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span>
<span></span>
<span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">single_buffer</span>, <span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">old_buildings_per_km2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        begin <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        end <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                        option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-area-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-conservation-rules-have-changed." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-conservation-rules-have-changed." class="callout-inner">
<h3 class="callout-title">Challenge: Conservation rules have changed.</h3>
<div class="callout-content">
<p>The historical threshold now applies to all pre-war buildings, but
the distance to these building is reduced to 10m. Can you map the
density of all buildings per 10m fused buffer?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fl">1939</span> </span>
<span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># select</span></span>
<span><span class="va">old_buildings</span> <span class="op">&lt;-</span> <span class="va">buildings</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">start_date</span> <span class="op">&lt;=</span> <span class="va">old</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># buffer</span></span>
<span><span class="va">buffer_old_buildings</span> <span class="op">&lt;-</span> <span class="fu">st_buffer</span><span class="op">(</span><span class="va">old_buildings</span>, dist <span class="op">=</span> <span class="va">distance</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># union</span></span>
<span><span class="va">single_old_buffer</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="va">buffer_old_buildings</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span>to <span class="op">=</span> <span class="st">"POLYGON"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_as_sf</span><span class="op">(</span><span class="op">)</span>  </span>
<span> </span>
<span><span class="va">single_old_buffer</span> <span class="op">&lt;-</span> <span class="va">single_old_buffer</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="st">"ID"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">single_old_buffer</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">single_old_buffer</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># centroids</span></span>
<span><span class="va">centroids_old</span> <span class="op">&lt;-</span> <span class="fu">st_centroid</span><span class="op">(</span><span class="va">old_buildings</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">.</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span>  </span>
<span>  </span>
<span><span class="co"># intersection</span></span>
<span><span class="va">centroids_buffers</span> <span class="op">&lt;-</span> <span class="fu">st_intersection</span><span class="op">(</span><span class="va">centroids_old</span>,<span class="va">single_old_buffer</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span> </span>
<span><span class="va">centroid_by_buffer</span> <span class="op">&lt;-</span> <span class="va">centroids_buffers</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">single_buffer</span> <span class="op">&lt;-</span> <span class="va">single_old_buffer</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>n_buildings <span class="op">=</span> <span class="va">centroid_by_buffer</span><span class="op">$</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">single_buffer</span><span class="op">$</span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_area</span><span class="op">(</span><span class="va">single_buffer</span><span class="op">)</span>  <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">.</span>, <span class="va">km</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">single_buffer</span><span class="op">$</span><span class="va">old_buildings_per_km2</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">single_buffer</span><span class="op">$</span><span class="va">n_buildings</span> <span class="op">/</span> <span class="va">single_buffer</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span>
<span></span>
<span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">single_buffer</span>, <span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">old_buildings_per_km2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        begin <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                        end <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                        option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/19-basic-gis-with-r-sf-rendered-parameters-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the <code>st_*</code> functions from <code>sf</code> for basic
GIS operations</li>
<li>Perform unions, joins and intersection operations</li>
<li>Compute the area of spatial polygons with
<code>st_area()</code>
</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/r-geospatial-urban/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/r-geospatial-urban/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/r-geospatial-urban/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/r-geospatial-urban/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:rbanism@tudelft.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.6" class="external-link">varnish (1.0.6)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://carpentries-incubator.github.io/r-geospatial-urban/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, geospatial",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/r-geospatial-urban/instructor/aio.html",
  "identifier": "https://carpentries-incubator.github.io/r-geospatial-urban/instructor/aio.html",
  "dateCreated": "2025-02-11",
  "dateModified": "2025-05-13",
  "datePublished": "2025-05-13"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

